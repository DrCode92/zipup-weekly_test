<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>데이터 독립성(Data Independence)과 3단계 스키마 구조</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f5f5f4; color: #1f2937; }
        .chart-container { position: relative; width: 100%; max-width: 600px; margin-left: auto; margin-right: auto; height: 350px; max-height: 400px; }
        .nav-item.active { border-bottom: 2px solid #4f46e5; color: #4f46e5; font-weight: 700; }
        .tech-block { transition: all 0.3s ease; cursor: pointer; }
        .tech-block:hover { transform: translateY(-2px); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        .tech-block.selected { ring: 2px; ring-color: #4f46e5; background-color: #eef2ff; border-color: #4f46e5; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        #chat-sidebar { transition: transform 0.3s ease-in-out; }
        #chat-sidebar.closed { transform: translateX(100%); }
        #chat-sidebar.open { transform: translateX(0); }
        .typing-indicator span { display: inline-block; width: 6px; height: 6px; background-color: #4f46e5; border-radius: 50%; animation: typing 1.4s infinite ease-in-out both; margin: 0 2px; }
        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
        .prose h1,.prose h2,.prose h3 { font-weight: bold; margin-top: 1em; margin-bottom: 0.5em; color: #312e81; font-size: 1.1em; }
        .prose ul { list-style-type: disc; padding-left: 1.5em; margin-bottom: 1em; }
        .prose strong { color: #4338ca; }
        .prose p { margin-bottom: 0.8em; }
        .chat-msg { border-radius: 12px; padding: 10px 14px; margin-bottom: 10px; max-width: 85%; font-size: 0.95rem; }
        .chat-msg.user { background-color: #4f46e5; color: white; align-self: flex-end; margin-left: auto; }
        .chat-msg.ai { background-color: #f3f4f6; color: #1f2937; align-self: flex-start; border: 1px solid #e5e7eb; }
        .textbook-content h3 { font-size: 1.25rem; font-weight: 700; color: #1e3a8a; margin-top: 1.5rem; margin-bottom: 0.75rem; border-left: 4px solid #4f46e5; padding-left: 0.75rem; }
        .textbook-content h4 { font-size: 1.1rem; font-weight: 600; color: #374151; margin-top: 1rem; margin-bottom: 0.5rem; }
        .textbook-content p { margin-bottom: 1rem; line-height: 1.8; color: #4b5563; }
        .textbook-content ul { list-style-type: disc; padding-left: 1.5rem; margin-bottom: 1rem; color: #4b5563; }
        .textbook-content li { margin-bottom: 0.5rem; line-height: 1.7; }
        .textbook-content table { width: 100%; border-collapse: collapse; margin-bottom: 1.5rem; font-size: 0.95rem; }
        .textbook-content th,.textbook-content td { border: 1px solid #e5e7eb; padding: 0.75rem; text-align: left; }
        .textbook-content th { background-color: #f9fafb; font-weight: 600; color: #1f2937; }
        .textbook-content .highlight { background-color: #eef2ff; color: #4338ca; font-weight: 600; padding: 0 4px; border-radius: 4px; }
        .textbook-content pre { background-color: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 1rem; overflow-x: auto; margin-bottom: 1rem; font-size: 0.85rem; line-height: 1.6; }
        .textbook-content code { font-family: 'Courier New', monospace; }
        .def-box { background: linear-gradient(135deg, #eef2ff 0%, #e0e7ff 100%); border-left: 4px solid #4f46e5; border-radius: 8px; padding: 1.25rem; margin-bottom: 1rem; }
        .def-box p { color: #312e81; font-weight: 500; margin: 0; line-height: 1.8; }
        .insight-box { background-color: #fffbeb; border: 1px solid #fde68a; border-radius: 8px; padding: 1rem; margin: 1rem 0; }
        .insight-box::before { content: '\1F4A1'; margin-right: 0.5rem; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
    </style>
</head>
<body class="bg-stone-100 min-h-screen flex flex-col overflow-x-hidden">
    <header class="bg-white shadow-sm sticky top-0 z-40">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center pt-3 pb-1">
                <div class="flex flex-col justify-center min-w-0">
                    <span class="text-[10px] sm:text-xs text-indigo-600 font-bold uppercase tracking-wider leading-tight">KPC 정보관리기술사 ZIP-UP 심화반</span>
                    <div class="flex items-center gap-2">
                        <span class="text-lg sm:text-xl font-bold text-gray-900 tracking-tight truncate">데이터 독립성(Data Independence)과 3단계 스키마 구조</span>
                        <span class="text-[10px] sm:text-xs bg-indigo-100 text-indigo-700 px-2 py-0.5 rounded-full font-bold flex-shrink-0">2026</span>
                    </div>
                </div>
            </div>
            <nav class="flex space-x-1 sm:space-x-4 overflow-x-auto no-scrollbar pb-1 items-center">
                <button onclick="navTo('overview')" id="nav-overview" class="nav-item active px-1 pt-1 pb-2 text-xs sm:text-sm font-medium text-gray-900 whitespace-nowrap">개요 및 개념</button>
                <button onclick="navTo('schema')" id="nav-schema" class="nav-item px-1 pt-1 pb-2 text-xs sm:text-sm font-medium text-gray-500 hover:text-gray-700 whitespace-nowrap">3단계 스키마</button>
                <button onclick="navTo('independence')" id="nav-independence" class="nav-item px-1 pt-1 pb-2 text-xs sm:text-sm font-medium text-gray-500 hover:text-gray-700 whitespace-nowrap">데이터 독립성</button>
                <button onclick="navTo('modern')" id="nav-modern" class="nav-item px-1 pt-1 pb-2 text-xs sm:text-sm font-medium text-gray-500 hover:text-gray-700 whitespace-nowrap">현대적 발전</button>
                <button onclick="navTo('textbook')" id="nav-textbook" class="nav-item px-1 pt-1 pb-2 text-xs sm:text-sm font-medium text-gray-500 hover:text-gray-700 whitespace-nowrap">원문 학습</button>
                <button onclick="navTo('script')" id="nav-script" class="nav-item px-1 pt-1 pb-2 text-xs sm:text-sm font-medium text-amber-600 hover:text-amber-800 whitespace-nowrap hidden">🎬 강의 스크립트</button>
                <button onclick="navTo('quiz')" id="nav-quiz" class="nav-item px-1 pt-1 pb-2 text-xs sm:text-sm font-medium text-indigo-600 hover:text-indigo-800 whitespace-nowrap">퀴즈 &amp; 암기</button>
                <span class="w-px h-4 bg-gray-300 flex-shrink-0"></span>
                <button onclick="toggleSettings()" class="flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium text-indigo-600 hover:bg-indigo-50 border border-indigo-200 hover:border-indigo-400 transition-all whitespace-nowrap flex-shrink-0" title="API Key 설정">&#128273; API</button>
            </nav>
        </div>
    </header>

    <main class="flex-grow max-w-5xl w-full mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-12 pb-24">

    <!-- ===== 탭1: 개요 및 개념 ===== -->
    <div id="overview">
        <div class="bg-white rounded-xl shadow-sm p-6 sm:p-8 animate-fade-in">
            <h2 class="text-xl sm:text-2xl font-bold text-gray-900 mb-6">개요 및 개념</h2>

            <!-- 정의 박스 -->
            <div class="def-box">
                <p><strong>데이터 독립성(Data Independence)</strong>이란, 하위 단계의 데이터 구조가 변경되더라도 상위 단계에 영향을 미치지 않는 성질로, ANSI/SPARC 3단계 스키마 구조에서 스키마 간 사상(Mapping)을 통해 실현되는 데이터베이스 시스템의 근본적 설계 목표이다.</p>
            </div>
            <div class="def-box" style="margin-top:0.5rem;">
                <p><strong>3단계 스키마 구조(Three-Schema Architecture)</strong>란, 데이터를 외부(사용자 뷰)–개념(통합 논리)–내부(물리 저장)의 3수준으로 분리하여 데이터 독립성을 구조적으로 보장하는 DBMS 참조 아키텍처이다. (ANSI/SPARC, 1975)</p>
            </div>

            <!-- 개념 해설 -->
            <div class="mt-6 mb-6">
                <h3 class="text-lg font-bold text-gray-800 mb-3">쉽게 이해하기</h3>
                <p class="text-gray-600 leading-relaxed mb-3">아파트 건물을 생각해보세요. <strong class="text-indigo-600">외부 스키마</strong>는 각 세대에서 보는 우리 집 구조(평면도)이고, <strong class="text-indigo-600">개념 스키마</strong>는 건물 전체의 설계도면이며, <strong class="text-indigo-600">내부 스키마</strong>는 콘크리트·배관·전기 배선 같은 물리적 시공 구조입니다.</p>
                <p class="text-gray-600 leading-relaxed">배관 공사를 다시 한다고(내부 스키마 변경) 해서 집 구조(개념 스키마)가 바뀌지 않고, 건물에 새 층을 추가한다고(개념 스키마 변경) 해서 기존 세대의 평면도(외부 스키마)가 바뀌지 않도록 하는 것 — 이것이 바로 <strong class="text-indigo-600">데이터 독립성</strong>의 핵심 아이디어입니다.</p>
            </div>

            <!-- 배경 카드 -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div class="bg-red-50 rounded-lg p-5 border-l-4 border-red-400">
                    <h4 class="font-bold text-red-800 mb-2">🔥 문제: 데이터 종속성</h4>
                    <p class="text-red-700 text-sm leading-relaxed">파일 시스템 시대에는 응용 프로그램과 데이터가 긴밀하게 결합(Tight Coupling)되어, 데이터 구조가 변경되면 모든 응용 프로그램을 수정해야 했다. 데이터 중복·불일치·유지보수 비용 폭증이 발생.</p>
                </div>
                <div class="bg-green-50 rounded-lg p-5 border-l-4 border-green-400">
                    <h4 class="font-bold text-green-800 mb-2">✅ 해결: 3단계 스키마</h4>
                    <p class="text-green-700 text-sm leading-relaxed">E.F. Codd(1970)의 관계형 모델이 이론적 토대를 마련하고, ANSI/SPARC(1975)가 3단계 스키마 아키텍처를 표준 프레임워크로 제안하여 데이터 독립성을 구조적으로 보장.</p>
                </div>
            </div>

            <!-- 핵심 용어 테이블 -->
            <h3 class="text-lg font-bold text-gray-800 mb-3">핵심 용어 정의</h3>
            <div class="overflow-x-auto">
                <table class="w-full text-sm border-collapse mb-4">
                    <thead><tr class="bg-gray-50">
                        <th class="border border-gray-200 px-3 py-2 text-left font-bold">용어</th>
                        <th class="border border-gray-200 px-3 py-2 text-left font-bold">정의</th>
                        <th class="border border-gray-200 px-3 py-2 text-left font-bold">핵심 포인트</th>
                    </tr></thead>
                    <tbody>
                        <tr><td class="border border-gray-200 px-3 py-2 font-medium">데이터 독립성</td><td class="border border-gray-200 px-3 py-2">하위 단계의 데이터 구조가 변경되더라도 상위 단계에 영향을 미치지 않는 성질</td><td class="border border-gray-200 px-3 py-2">변경의 파급 효과(Ripple Effect) 차단이 본질</td></tr>
                        <tr><td class="border border-gray-200 px-3 py-2 font-medium">스키마(Schema)</td><td class="border border-gray-200 px-3 py-2">데이터베이스의 구조와 제약조건에 대한 전반적인 명세</td><td class="border border-gray-200 px-3 py-2">데이터 사전(Data Dictionary)에 저장되는 메타데이터</td></tr>
                        <tr><td class="border border-gray-200 px-3 py-2 font-medium">사상/매핑(Mapping)</td><td class="border border-gray-200 px-3 py-2">서로 다른 추상화 수준의 스키마 간 대응 관계를 정의하는 변환 규칙</td><td class="border border-gray-200 px-3 py-2">스키마 간 독립성을 실현하는 핵심 메커니즘</td></tr>
                        <tr><td class="border border-gray-200 px-3 py-2 font-medium">인스턴스(Instance)</td><td class="border border-gray-200 px-3 py-2">특정 시점에 스키마에 따라 저장된 실제 데이터의 집합</td><td class="border border-gray-200 px-3 py-2">스키마는 구조(틀), 인스턴스는 내용(값)</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- 차트: 3단계 스키마 개요 레이더 -->
            <h3 class="text-lg font-bold text-gray-800 mb-3 mt-6">3단계 스키마 특성 비교</h3>
            <div class="chart-container"><canvas id="overviewRadar"></canvas></div>
            <p class="text-xs text-gray-400 text-center mt-2">* 점수는 각 특성의 상대적 비교를 위한 예시 값입니다.</p>
        </div>
    </div>

    <!-- ===== 탭2: 3단계 스키마 ===== -->
    <div id="schema" class="hidden">
        <div class="bg-white rounded-xl shadow-sm p-6 sm:p-8 animate-fade-in">
            <h2 class="text-xl sm:text-2xl font-bold text-gray-900 mb-6">ANSI/SPARC 3단계 스키마 구조</h2>

            <!-- 구조도: HTML/CSS 시각화 -->
            <div class="bg-gradient-to-b from-slate-50 to-white rounded-xl p-4 sm:p-6 mb-6 border border-slate-200">
                <h3 class="text-base font-bold text-slate-700 mb-4 text-center">3단계 스키마 아키텍처 계층도</h3>
                <div class="max-w-lg mx-auto space-y-0">
                    <!-- 사용자 레이어 -->
                    <div class="flex justify-center gap-3 sm:gap-4 mb-2">
                        <div class="text-center"><div class="w-10 h-10 sm:w-12 sm:h-12 bg-indigo-100 rounded-full flex items-center justify-center text-lg sm:text-xl">👤</div><p class="text-[10px] sm:text-xs text-gray-500 mt-1">사용자 A</p></div>
                        <div class="text-center"><div class="w-10 h-10 sm:w-12 sm:h-12 bg-indigo-100 rounded-full flex items-center justify-center text-lg sm:text-xl">👤</div><p class="text-[10px] sm:text-xs text-gray-500 mt-1">사용자 B</p></div>
                        <div class="text-center"><div class="w-10 h-10 sm:w-12 sm:h-12 bg-indigo-100 rounded-full flex items-center justify-center text-lg sm:text-xl">👤</div><p class="text-[10px] sm:text-xs text-gray-500 mt-1">사용자 C</p></div>
                    </div>
                    <!-- 화살표 -->
                    <div class="flex justify-center"><div class="w-px h-4 bg-gray-300"></div></div>
                    <!-- 외부 스키마 -->
                    <div class="relative">
                        <div class="absolute -left-2 sm:left-0 top-1/2 -translate-y-1/2 text-[10px] sm:text-xs font-bold text-indigo-500 writing-mode-vertical hidden sm:block" style="writing-mode:vertical-rl;transform:rotate(180deg) translateY(50%);">External</div>
                        <div class="flex justify-center gap-2 sm:gap-3">
                            <div class="bg-indigo-50 border-2 border-indigo-300 rounded-lg px-3 py-2 text-center shadow-sm"><p class="text-xs sm:text-sm font-bold text-indigo-700">외부 스키마 1</p><p class="text-[10px] text-indigo-400">VIEW</p></div>
                            <div class="bg-indigo-50 border-2 border-indigo-300 rounded-lg px-3 py-2 text-center shadow-sm"><p class="text-xs sm:text-sm font-bold text-indigo-700">외부 스키마 2</p><p class="text-[10px] text-indigo-400">VIEW</p></div>
                            <div class="bg-indigo-50 border-2 border-indigo-300 rounded-lg px-3 py-2 text-center shadow-sm"><p class="text-xs sm:text-sm font-bold text-indigo-700">외부 스키마 3</p><p class="text-[10px] text-indigo-400">VIEW</p></div>
                        </div>
                    </div>
                    <!-- E-C Mapping -->
                    <div class="flex justify-center py-2">
                        <div class="flex items-center gap-2 bg-blue-100 border border-blue-300 rounded-full px-4 py-1">
                            <span class="text-[10px] sm:text-xs font-bold text-blue-700">⬆⬇ 외부/개념 사상 (E-C Mapping)</span>
                            <span class="text-[10px] text-blue-500">— 논리적 독립성</span>
                        </div>
                    </div>
                    <!-- 개념 스키마 -->
                    <div class="flex justify-center">
                        <div class="bg-green-50 border-2 border-green-400 rounded-xl px-6 sm:px-10 py-3 text-center shadow-sm w-full max-w-xs">
                            <p class="text-sm sm:text-base font-bold text-green-700">개념 스키마</p>
                            <p class="text-[10px] sm:text-xs text-green-500">Conceptual Schema · 전체 논리 뷰 · 1개</p>
                        </div>
                    </div>
                    <!-- C-I Mapping -->
                    <div class="flex justify-center py-2">
                        <div class="flex items-center gap-2 bg-orange-100 border border-orange-300 rounded-full px-4 py-1">
                            <span class="text-[10px] sm:text-xs font-bold text-orange-700">⬆⬇ 개념/내부 사상 (C-I Mapping)</span>
                            <span class="text-[10px] text-orange-500">— 물리적 독립성</span>
                        </div>
                    </div>
                    <!-- 내부 스키마 -->
                    <div class="flex justify-center">
                        <div class="bg-purple-50 border-2 border-purple-400 rounded-xl px-6 sm:px-10 py-3 text-center shadow-sm w-full max-w-xs">
                            <p class="text-sm sm:text-base font-bold text-purple-700">내부 스키마</p>
                            <p class="text-[10px] sm:text-xs text-purple-500">Internal Schema · 물리 저장 구조 · 1개</p>
                        </div>
                    </div>
                    <!-- 화살표 -->
                    <div class="flex justify-center"><div class="w-px h-4 bg-gray-300"></div></div>
                    <!-- 물리적 저장장치 -->
                    <div class="flex justify-center">
                        <div class="bg-gray-100 border-2 border-gray-400 rounded-xl px-6 sm:px-10 py-3 text-center w-full max-w-xs">
                            <p class="text-sm font-bold text-gray-600">💾 물리적 저장장치</p>
                            <p class="text-[10px] text-gray-400">Physical Storage (Disk, SSD)</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 클릭 확장 카드: 각 스키마 단계 -->
            <h3 class="text-lg font-bold text-gray-800 mb-4">각 스키마 단계 상세 (클릭하여 펼치기)</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div class="tech-block bg-white border-2 border-indigo-200 rounded-xl p-4" id="block-external" onclick="updateSchemaDetail('external')">
                    <div class="text-2xl mb-2">👤</div>
                    <h4 class="font-bold text-indigo-700">외부 스키마</h4>
                    <p class="text-xs text-gray-500 mt-1">External Schema · 사용자 뷰</p>
                </div>
                <div class="tech-block bg-white border-2 border-green-200 rounded-xl p-4" id="block-conceptual" onclick="updateSchemaDetail('conceptual')">
                    <div class="text-2xl mb-2">🏢</div>
                    <h4 class="font-bold text-green-700">개념 스키마</h4>
                    <p class="text-xs text-gray-500 mt-1">Conceptual Schema · 전체 논리 뷰</p>
                </div>
                <div class="tech-block bg-white border-2 border-purple-200 rounded-xl p-4" id="block-internal" onclick="updateSchemaDetail('internal')">
                    <div class="text-2xl mb-2">💾</div>
                    <h4 class="font-bold text-purple-700">내부 스키마</h4>
                    <p class="text-xs text-gray-500 mt-1">Internal Schema · 물리 저장 구조</p>
                </div>
            </div>
            <div id="schema-detail-content" class="bg-gray-50 rounded-xl p-5 border border-gray-200 min-h-[200px] transition-all">
                <p class="text-gray-400 text-sm">위 카드를 클릭하면 상세 설명이 표시됩니다.</p>
            </div>

            <!-- 비교표 -->
            <h3 class="text-lg font-bold text-gray-800 mt-8 mb-4">3단계 스키마 요약 비교표</h3>
            <div class="overflow-x-auto">
                <table class="w-full text-sm border-collapse">
                    <thead><tr class="bg-gray-50">
                        <th class="border border-gray-200 px-3 py-2 text-left font-bold">구분</th>
                        <th class="border border-gray-200 px-3 py-2 text-left font-bold text-indigo-700">외부 스키마</th>
                        <th class="border border-gray-200 px-3 py-2 text-left font-bold text-green-700">개념 스키마</th>
                        <th class="border border-gray-200 px-3 py-2 text-left font-bold text-purple-700">내부 스키마</th>
                    </tr></thead>
                    <tbody>
                        <tr><td class="border border-gray-200 px-3 py-2 font-medium">별칭</td><td class="border border-gray-200 px-3 py-2">사용자 뷰, 서브 스키마</td><td class="border border-gray-200 px-3 py-2">전체 뷰, 논리 스키마</td><td class="border border-gray-200 px-3 py-2">저장 스키마</td></tr>
                        <tr><td class="border border-gray-200 px-3 py-2 font-medium">관점</td><td class="border border-gray-200 px-3 py-2">개별 사용자/응용</td><td class="border border-gray-200 px-3 py-2">조직 전체</td><td class="border border-gray-200 px-3 py-2">DBA/시스템</td></tr>
                        <tr><td class="border border-gray-200 px-3 py-2 font-medium">기술 내용</td><td class="border border-gray-200 px-3 py-2">특정 사용자가 필요한 데이터의 논리적 구조</td><td class="border border-gray-200 px-3 py-2">전체 데이터의 통합된 논리적 구조</td><td class="border border-gray-200 px-3 py-2">데이터의 물리적 저장 구조</td></tr>
                        <tr><td class="border border-gray-200 px-3 py-2 font-medium">주요 요소</td><td class="border border-gray-200 px-3 py-2">뷰(View), 사용자 정의 타입</td><td class="border border-gray-200 px-3 py-2">엔터티, 관계, 제약조건, 보안 규칙</td><td class="border border-gray-200 px-3 py-2">레코드 형식, 인덱스, 저장 경로</td></tr>
                        <tr><td class="border border-gray-200 px-3 py-2 font-medium">개수</td><td class="border border-gray-200 px-3 py-2"><strong>다수</strong> (사용자별)</td><td class="border border-gray-200 px-3 py-2"><strong>1개</strong></td><td class="border border-gray-200 px-3 py-2"><strong>1개</strong></td></tr>
                        <tr><td class="border border-gray-200 px-3 py-2 font-medium">정의 주체</td><td class="border border-gray-200 px-3 py-2">응용 프로그래머, 최종 사용자</td><td class="border border-gray-200 px-3 py-2">DBA</td><td class="border border-gray-200 px-3 py-2">DBA, 시스템 설계자</td></tr>
                        <tr><td class="border border-gray-200 px-3 py-2 font-medium">DDL</td><td class="border border-gray-200 px-3 py-2">CREATE VIEW 등</td><td class="border border-gray-200 px-3 py-2">CREATE TABLE 등</td><td class="border border-gray-200 px-3 py-2">CREATE INDEX, TABLESPACE 등</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- ===== 탭3: 데이터 독립성 ===== -->
    <div id="independence" class="hidden">
        <div class="bg-white rounded-xl shadow-sm p-6 sm:p-8 animate-fade-in">
            <h2 class="text-xl sm:text-2xl font-bold text-gray-900 mb-6">사상(Mapping)과 데이터 독립성</h2>

            <!-- 두 가지 사상 -->
            <h3 class="text-lg font-bold text-gray-800 mb-4">두 가지 사상(Mapping)</h3>
            <div class="overflow-x-auto mb-6">
                <table class="w-full text-sm border-collapse">
                    <thead><tr class="bg-gray-50">
                        <th class="border border-gray-200 px-3 py-2 text-left font-bold">구분</th>
                        <th class="border border-gray-200 px-3 py-2 text-left font-bold text-blue-700">외부/개념 사상 (E-C)</th>
                        <th class="border border-gray-200 px-3 py-2 text-left font-bold text-orange-700">개념/내부 사상 (C-I)</th>
                    </tr></thead>
                    <tbody>
                        <tr><td class="border border-gray-200 px-3 py-2 font-medium">위치</td><td class="border border-gray-200 px-3 py-2">외부 스키마 ↔ 개념 스키마</td><td class="border border-gray-200 px-3 py-2">개념 스키마 ↔ 내부 스키마</td></tr>
                        <tr><td class="border border-gray-200 px-3 py-2 font-medium">역할</td><td class="border border-gray-200 px-3 py-2">사용자 뷰와 전체 논리 구조 간 대응</td><td class="border border-gray-200 px-3 py-2">논리적 구조와 물리적 저장 간 대응</td></tr>
                        <tr><td class="border border-gray-200 px-3 py-2 font-medium">변환 내용</td><td class="border border-gray-200 px-3 py-2">뷰 정의, 컬럼 매핑, 접근 권한</td><td class="border border-gray-200 px-3 py-2">테이블→레코드, 컬럼→필드, 관계→인덱스</td></tr>
                        <tr><td class="border border-gray-200 px-3 py-2 font-medium">보장하는 독립성</td><td class="border border-gray-200 px-3 py-2"><strong class="text-blue-700">논리적 데이터 독립성</strong></td><td class="border border-gray-200 px-3 py-2"><strong class="text-orange-700">물리적 데이터 독립성</strong></td></tr>
                        <tr><td class="border border-gray-200 px-3 py-2 font-medium">변경 시나리오</td><td class="border border-gray-200 px-3 py-2">컬럼 추가/삭제 시 뷰 재정의</td><td class="border border-gray-200 px-3 py-2">인덱스 추가, 파티셔닝 시 매핑 수정</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- 클릭 확장: 논리적 vs 물리적 -->
            <h3 class="text-lg font-bold text-gray-800 mb-4">데이터 독립성 상세 (클릭하여 펼치기)</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div class="tech-block bg-white border-2 border-blue-200 rounded-xl p-5" id="block-logical" onclick="updateIndepDetail('logical')">
                    <div class="text-2xl mb-2">🧠</div>
                    <h4 class="font-bold text-blue-700">논리적 데이터 독립성</h4>
                    <p class="text-xs text-gray-500 mt-1">Logical Data Independence</p>
                    <p class="text-sm text-gray-600 mt-2">개념 스키마 변경 → 외부 스키마 영향 없음</p>
                </div>
                <div class="tech-block bg-white border-2 border-orange-200 rounded-xl p-5" id="block-physical" onclick="updateIndepDetail('physical')">
                    <div class="text-2xl mb-2">⚙️</div>
                    <h4 class="font-bold text-orange-700">물리적 데이터 독립성</h4>
                    <p class="text-xs text-gray-500 mt-1">Physical Data Independence</p>
                    <p class="text-sm text-gray-600 mt-2">내부 스키마 변경 → 개념 스키마 영향 없음</p>
                </div>
            </div>
            <div id="indep-detail-content" class="bg-gray-50 rounded-xl p-5 border border-gray-200 min-h-[200px] transition-all">
                <p class="text-gray-400 text-sm">위 카드를 클릭하면 상세 설명이 표시됩니다.</p>
            </div>

            <!-- 비교표 -->
            <h3 class="text-lg font-bold text-gray-800 mt-8 mb-4">논리적 vs 물리적 데이터 독립성 비교</h3>
            <div class="overflow-x-auto mb-6">
                <table class="w-full text-sm border-collapse">
                    <thead><tr class="bg-gray-50">
                        <th class="border border-gray-200 px-3 py-2 text-left font-bold">비교 기준</th>
                        <th class="border border-gray-200 px-3 py-2 text-left font-bold text-blue-700">논리적 데이터 독립성</th>
                        <th class="border border-gray-200 px-3 py-2 text-left font-bold text-orange-700">물리적 데이터 독립성</th>
                    </tr></thead>
                    <tbody>
                        <tr><td class="border border-gray-200 px-3 py-2 font-medium">정의</td><td class="border border-gray-200 px-3 py-2">개념 스키마 변경 시 외부 스키마에 영향 없음</td><td class="border border-gray-200 px-3 py-2">내부 스키마 변경 시 개념 스키마에 영향 없음</td></tr>
                        <tr><td class="border border-gray-200 px-3 py-2 font-medium">사상</td><td class="border border-gray-200 px-3 py-2">외부/개념 사상 (E-C Mapping)</td><td class="border border-gray-200 px-3 py-2">개념/내부 사상 (C-I Mapping)</td></tr>
                        <tr><td class="border border-gray-200 px-3 py-2 font-medium">변경 주체</td><td class="border border-gray-200 px-3 py-2">DBA (테이블 구조 변경)</td><td class="border border-gray-200 px-3 py-2">DBA/시스템 (물리적 저장 구조 변경)</td></tr>
                        <tr><td class="border border-gray-200 px-3 py-2 font-medium">실현 난이도</td><td class="border border-gray-200 px-3 py-2"><strong class="text-red-600">높음</strong> (의미적 변경 수반)</td><td class="border border-gray-200 px-3 py-2"><strong class="text-green-600">낮음</strong> (물리적 변경만 수반)</td></tr>
                        <tr><td class="border border-gray-200 px-3 py-2 font-medium">영향 범위</td><td class="border border-gray-200 px-3 py-2">모든 외부 스키마 검토 필요</td><td class="border border-gray-200 px-3 py-2">개념 스키마에만 영향</td></tr>
                        <tr><td class="border border-gray-200 px-3 py-2 font-medium">대표 사례</td><td class="border border-gray-200 px-3 py-2">테이블 분리/통합, 컬럼 추가/삭제</td><td class="border border-gray-200 px-3 py-2">인덱스 변경, 파티셔닝, 저장장치 교체</td></tr>
                        <tr><td class="border border-gray-200 px-3 py-2 font-medium">DBMS 지원</td><td class="border border-gray-200 px-3 py-2">부분적 (뷰 메커니즘)</td><td class="border border-gray-200 px-3 py-2">대부분 자동 지원</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- 차트: 실현 난이도 비교 -->
            <h3 class="text-lg font-bold text-gray-800 mb-3">데이터 독립성 실현 난이도 비교</h3>
            <div class="chart-container"><canvas id="indepChart"></canvas></div>
            <p class="text-xs text-gray-400 text-center mt-2">* 점수는 상대적 비교를 위한 예시 값입니다.</p>
        </div>
    </div>

    <!-- ===== 탭4: 현대적 발전 ===== -->
    <div id="modern" class="hidden">
        <div class="bg-white rounded-xl shadow-sm p-6 sm:p-8 animate-fade-in">
            <h2 class="text-xl sm:text-2xl font-bold text-gray-900 mb-6">현대적 발전과 변형</h2>

            <!-- 장단점 -->
            <h3 class="text-lg font-bold text-gray-800 mb-4">3단계 스키마 구조의 장점</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 mb-6">
                <div class="bg-indigo-50 rounded-lg p-4 border-l-4 border-indigo-400">
                    <h4 class="font-bold text-indigo-800 text-sm mb-1">데이터 독립성 보장</h4>
                    <p class="text-xs text-indigo-700 leading-relaxed">각 수준의 변경이 다른 수준에 파급되지 않아 유지보수 비용 절감</p>
                </div>
                <div class="bg-green-50 rounded-lg p-4 border-l-4 border-green-400">
                    <h4 class="font-bold text-green-800 text-sm mb-1">보안 강화</h4>
                    <p class="text-xs text-green-700 leading-relaxed">외부 스키마를 통해 사용자별 접근 범위를 제한</p>
                </div>
                <div class="bg-purple-50 rounded-lg p-4 border-l-4 border-purple-400">
                    <h4 class="font-bold text-purple-800 text-sm mb-1">데이터 통합 관리</h4>
                    <p class="text-xs text-purple-700 leading-relaxed">개념 스키마를 통해 조직 전체 데이터를 일원적으로 관리, 중복 제거</p>
                </div>
                <div class="bg-amber-50 rounded-lg p-4 border-l-4 border-amber-400">
                    <h4 class="font-bold text-amber-800 text-sm mb-1">성능 최적화 유연성</h4>
                    <p class="text-xs text-amber-700 leading-relaxed">내부 스키마 수준에서 인덱스, 파티셔닝 등을 자유롭게 조정</p>
                </div>
                <div class="bg-teal-50 rounded-lg p-4 border-l-4 border-teal-400">
                    <h4 class="font-bold text-teal-800 text-sm mb-1">다양한 사용자 뷰</h4>
                    <p class="text-xs text-teal-700 leading-relaxed">동일 데이터를 마케팅, 재무, 인사 등 다양한 관점에서 접근 가능</p>
                </div>
            </div>

            <!-- 한계 -->
            <h3 class="text-lg font-bold text-gray-800 mb-4">한계 및 비판</h3>
            <div class="space-y-3 mb-8">
                <div class="bg-red-50 rounded-lg p-4 border border-red-200 cursor-pointer" onclick="toggleStrategy(this)">
                    <div class="strategy-summary flex justify-between items-center">
                        <span class="font-medium text-red-800 text-sm">완벽한 논리적 독립성의 어려움</span>
                        <span class="text-red-400 text-xs">▼ 펼치기</span>
                    </div>
                    <div class="strategy-detail hidden mt-3 text-sm text-red-700 leading-relaxed">개념 스키마의 대규모 변경 시 뷰 재정의만으로 모든 호환성을 보장하기 어려움. 데이터의 의미(Semantics)가 근본적으로 변경되는 경우 외부 스키마의 완전한 독립성 유지가 불가능할 수 있다.</div>
                </div>
                <div class="bg-red-50 rounded-lg p-4 border border-red-200 cursor-pointer" onclick="toggleStrategy(this)">
                    <div class="strategy-summary flex justify-between items-center">
                        <span class="font-medium text-red-800 text-sm">성능 오버헤드</span>
                        <span class="text-red-400 text-xs">▼ 펼치기</span>
                    </div>
                    <div class="strategy-detail hidden mt-3 text-sm text-red-700 leading-relaxed">다중 사상(Mapping)으로 인한 질의 변환 오버헤드가 발생할 수 있다. 특히 복잡한 뷰가 중첩된 경우 쿼리 최적화가 어려워진다.</div>
                </div>
                <div class="bg-red-50 rounded-lg p-4 border border-red-200 cursor-pointer" onclick="toggleStrategy(this)">
                    <div class="strategy-summary flex justify-between items-center">
                        <span class="font-medium text-red-800 text-sm">NoSQL의 도전</span>
                        <span class="text-red-400 text-xs">▼ 펼치기</span>
                    </div>
                    <div class="strategy-detail hidden mt-3 text-sm text-red-700 leading-relaxed">MongoDB 등 스키마리스(Schemaless) DB는 고정된 개념 스키마 자체를 부정. 다만 이는 개념 스키마의 정의 시점을 설계 시(Design-time)에서 실행 시(Runtime)로 이동시킨 것으로 해석 가능.</div>
                </div>
                <div class="bg-red-50 rounded-lg p-4 border border-red-200 cursor-pointer" onclick="toggleStrategy(this)">
                    <div class="strategy-summary flex justify-between items-center">
                        <span class="font-medium text-red-800 text-sm">실시간 스키마 진화</span>
                        <span class="text-red-400 text-xs">▼ 펼치기</span>
                    </div>
                    <div class="strategy-detail hidden mt-3 text-sm text-red-700 leading-relaxed">대규모 시스템에서 무중단 스키마 변경(Online DDL)은 여전히 도전적 과제. 수십억 행 테이블의 구조 변경은 상당한 시간과 잠금(Lock)이 필요할 수 있다.</div>
                </div>
            </div>

            <!-- 데이터 레이크하우스 비교 -->
            <h3 class="text-lg font-bold text-gray-800 mb-4">데이터 레이크하우스에서의 계승</h3>
            <div class="overflow-x-auto mb-6">
                <table class="w-full text-sm border-collapse">
                    <thead><tr class="bg-gray-50">
                        <th class="border border-gray-200 px-3 py-2 text-left font-bold">전통적 RDBMS</th>
                        <th class="border border-gray-200 px-3 py-2 text-left font-bold">데이터 레이크하우스</th>
                        <th class="border border-gray-200 px-3 py-2 text-left font-bold">계승 관점</th>
                    </tr></thead>
                    <tbody>
                        <tr><td class="border border-gray-200 px-3 py-2">외부 스키마</td><td class="border border-gray-200 px-3 py-2">Materialized View, BI 계층</td><td class="border border-gray-200 px-3 py-2">사용자별 분석 뷰 제공</td></tr>
                        <tr><td class="border border-gray-200 px-3 py-2">개념 스키마</td><td class="border border-gray-200 px-3 py-2">Delta Lake 테이블 메타데이터</td><td class="border border-gray-200 px-3 py-2">스키마 진화(Schema Evolution) 지원</td></tr>
                        <tr><td class="border border-gray-200 px-3 py-2">내부 스키마</td><td class="border border-gray-200 px-3 py-2">Parquet/ORC 파일 포맷, 파티셔닝</td><td class="border border-gray-200 px-3 py-2">물리적 저장 최적화</td></tr>
                        <tr><td class="border border-gray-200 px-3 py-2">외부/개념 사상</td><td class="border border-gray-200 px-3 py-2">dbt(Data Build Tool) 변환 계층</td><td class="border border-gray-200 px-3 py-2">논리적 변환 규칙 관리</td></tr>
                        <tr><td class="border border-gray-200 px-3 py-2">개념/내부 사상</td><td class="border border-gray-200 px-3 py-2">Iceberg/Delta Lake 메타데이터</td><td class="border border-gray-200 px-3 py-2">파일→테이블 사상 자동 관리</td></tr>
                    </tbody>
                </table>
            </div>

            <div class="insight-box">
                <p class="text-sm text-amber-800 leading-relaxed"><strong>핵심 통찰:</strong> "Schema-on-Read"와 "Schema-on-Write"의 구분은 3단계 스키마 구조에서 개념 스키마와 내부 스키마의 결합도를 조절하는 현대적 접근법이다.</p>
            </div>

            <!-- 연관 이론 -->
            <h3 class="text-lg font-bold text-gray-800 mt-6 mb-4">연관 이론</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-slate-50 rounded-lg p-4 border border-slate-200">
                    <h4 class="font-bold text-slate-700 text-sm mb-2">📜 ANSI/SPARC (1975)</h4>
                    <p class="text-xs text-slate-600 leading-relaxed">3단계 스키마 아키텍처의 원본. 데이터 독립성을 DBMS의 핵심 설계 원칙으로 공식화.</p>
                </div>
                <div class="bg-slate-50 rounded-lg p-4 border border-slate-200">
                    <h4 class="font-bold text-slate-700 text-sm mb-2">📐 Codd의 12규칙 (1985)</h4>
                    <p class="text-xs text-slate-600 leading-relaxed">Rule 8(Physical), Rule 9(Logical) Data Independence. 관계형 DBMS의 공식적 요구사항으로 명시.</p>
                </div>
                <div class="bg-slate-50 rounded-lg p-4 border border-slate-200">
                    <h4 class="font-bold text-slate-700 text-sm mb-2">🔄 추상화 원칙</h4>
                    <p class="text-xs text-slate-600 leading-relaxed">OSI 7계층, TCP/IP 4계층과 동일한 추상화 원칙의 DB 적용. 계층 간 독립성 확보.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== 탭5: 원문 학습 ===== -->
    <div id="textbook" class="hidden">
        <div class="bg-white rounded-xl shadow-sm p-6 sm:p-8 animate-fade-in">
            <h2 class="text-xl sm:text-2xl font-bold text-gray-900 mb-2">원문 학습</h2>
            <p class="text-sm text-gray-500 mb-6">교재 제1부(상세 해설) 원문을 충실히 재현한 학습 자료입니다.</p>
            <div class="textbook-content">

                <h3>제1장 개요 및 배경</h3>
                <h4>1.1 데이터 독립성의 등장 배경</h4>
                <p>데이터 독립성(Data Independence)은 데이터베이스 시스템의 가장 근본적인 설계 목표 중 하나이다. 이 개념은 1970년대 초, 데이터 관리 방식이 파일 시스템(File System) 기반에서 데이터베이스 관리 시스템(DBMS) 기반으로 전환되는 과정에서 핵심 과제로 부상하였다.</p>
                <p>파일 시스템 시대에는 응용 프로그램과 데이터가 긴밀하게 결합(Tight Coupling)되어 있었다. 즉, 데이터의 물리적 저장 구조나 파일 형식이 변경되면 해당 데이터를 사용하는 모든 응용 프로그램을 수정해야 하는 <span class="highlight">데이터 종속성(Data Dependency)</span> 문제가 심각하였다. 이로 인해 데이터 중복(Redundancy), 데이터 불일치(Inconsistency), 유지보수 비용 폭증이 발생하였다.</p>
                <p>이 문제를 근본적으로 해결하기 위해 E.F. Codd는 1970년 논문 <em>"A Relational Model of Data for Large Shared Data Banks"</em>에서 데이터의 논리적 표현과 물리적 저장을 분리하는 관계형 모델을 제안하였으며, 이것이 데이터 독립성 개념의 이론적 토대가 되었다.</p>
                <p>이후 1975년 ANSI(미국 국가표준원)의 SPARC(Standards Planning and Requirements Committee) 위원회는 DBMS 아키텍처의 표준 프레임워크로 <span class="highlight">3단계 스키마 구조(Three-Schema Architecture)</span>를 제안하였다. 이 아키텍처는 데이터를 외부(External), 개념(Conceptual), 내부(Internal)의 3개 추상화 수준으로 분리하여 데이터 독립성을 구조적으로 보장하는 설계 원칙이다.</p>

                <h4>1.2 핵심 용어 정의</h4>
                <table>
                    <thead><tr><th>용어</th><th>정의</th><th>핵심 포인트</th></tr></thead>
                    <tbody>
                        <tr><td>데이터 독립성 (Data Independence)</td><td>하위 단계의 데이터 구조가 변경되더라도 상위 단계에 영향을 미치지 않는 성질</td><td>변경의 파급 효과(Ripple Effect) 차단이 본질</td></tr>
                        <tr><td>스키마 (Schema)</td><td>데이터베이스의 구조와 제약조건에 대한 전반적인 명세(Specification)</td><td>데이터 사전(Data Dictionary)에 저장되는 메타데이터</td></tr>
                        <tr><td>사상/매핑 (Mapping)</td><td>서로 다른 추상화 수준의 스키마 간 대응 관계를 정의하는 변환 규칙</td><td>스키마 간 독립성을 실현하는 핵심 메커니즘</td></tr>
                        <tr><td>인스턴스 (Instance)</td><td>특정 시점에 스키마에 따라 저장된 실제 데이터의 집합</td><td>스키마는 구조(틀), 인스턴스는 내용(값)</td></tr>
                    </tbody>
                </table>

                <h3>제2장 ANSI/SPARC 3단계 스키마 구조 전체 개관</h3>
                <h4>2.1 3단계 스키마 아키텍처 계층도</h4>
                <p>ANSI/SPARC 3단계 스키마 아키텍처는 데이터베이스를 세 개의 추상화 수준으로 분리한다. 각 수준은 서로 다른 이해관계자의 관점을 반영하며, 수준 간 매핑을 통해 독립성을 보장한다.</p>
                <!-- 3단계 스키마 시각화 (원문 학습용) -->
                <div class="bg-gradient-to-b from-slate-50 to-white rounded-xl p-4 border border-slate-200 my-4">
                    <div class="max-w-md mx-auto space-y-0">
                        <div class="flex justify-center gap-2 mb-2">
                            <div class="text-center"><div class="w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center text-sm">👤</div><p class="text-[9px] text-gray-400">A</p></div>
                            <div class="text-center"><div class="w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center text-sm">👤</div><p class="text-[9px] text-gray-400">B</p></div>
                            <div class="text-center"><div class="w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center text-sm">👤</div><p class="text-[9px] text-gray-400">C</p></div>
                        </div>
                        <div class="flex justify-center"><div class="w-px h-3 bg-gray-300"></div></div>
                        <div class="flex justify-center gap-2">
                            <div class="bg-indigo-50 border border-indigo-300 rounded-lg px-2 py-1.5 text-center"><p class="text-xs font-bold text-indigo-700">외부 스키마 1</p></div>
                            <div class="bg-indigo-50 border border-indigo-300 rounded-lg px-2 py-1.5 text-center"><p class="text-xs font-bold text-indigo-700">외부 스키마 2</p></div>
                            <div class="bg-indigo-50 border border-indigo-300 rounded-lg px-2 py-1.5 text-center"><p class="text-xs font-bold text-indigo-700">외부 스키마 3</p></div>
                        </div>
                        <div class="flex justify-center py-1.5"><span class="bg-blue-100 border border-blue-300 rounded-full px-3 py-0.5 text-[10px] font-bold text-blue-700">⬆⬇ E-C Mapping (논리적 독립성)</span></div>
                        <div class="flex justify-center"><div class="bg-green-50 border-2 border-green-400 rounded-xl px-6 py-2 text-center w-full max-w-[260px]"><p class="text-sm font-bold text-green-700">개념 스키마</p><p class="text-[10px] text-green-500">Conceptual · 1개</p></div></div>
                        <div class="flex justify-center py-1.5"><span class="bg-orange-100 border border-orange-300 rounded-full px-3 py-0.5 text-[10px] font-bold text-orange-700">⬆⬇ C-I Mapping (물리적 독립성)</span></div>
                        <div class="flex justify-center"><div class="bg-purple-50 border-2 border-purple-400 rounded-xl px-6 py-2 text-center w-full max-w-[260px]"><p class="text-sm font-bold text-purple-700">내부 스키마</p><p class="text-[10px] text-purple-500">Internal · 1개</p></div></div>
                        <div class="flex justify-center"><div class="w-px h-3 bg-gray-300"></div></div>
                        <div class="flex justify-center"><div class="bg-gray-100 border border-gray-400 rounded-xl px-6 py-2 text-center w-full max-w-[260px]"><p class="text-xs font-bold text-gray-600">💾 물리적 저장장치</p></div></div>
                    </div>
                </div>

                <h4>2.2 3단계 스키마 요약 비교표</h4>
                <table>
                    <thead><tr><th>구분</th><th>외부 스키마 (External)</th><th>개념 스키마 (Conceptual)</th><th>내부 스키마 (Internal)</th></tr></thead>
                    <tbody>
                        <tr><td>별칭</td><td>사용자 뷰(User View), 서브 스키마</td><td>전체 뷰(Community View), 논리 스키마</td><td>저장 스키마(Storage Schema)</td></tr>
                        <tr><td>관점</td><td>개별 사용자/응용 프로그램</td><td>조직 전체</td><td>DBA/시스템</td></tr>
                        <tr><td>기술 내용</td><td>특정 사용자가 필요한 데이터의 논리적 구조</td><td>전체 데이터의 통합된 논리적 구조</td><td>데이터의 물리적 저장 구조</td></tr>
                        <tr><td>주요 요소</td><td>뷰(View), 사용자 정의 데이터 타입</td><td>엔터티, 관계, 제약조건, 보안/무결성 규칙</td><td>레코드 형식, 인덱스, 저장 경로, 압축</td></tr>
                        <tr><td>개수</td><td>다수 (사용자/응용별)</td><td>1개 (데이터베이스당)</td><td>1개 (데이터베이스당)</td></tr>
                        <tr><td>정의 주체</td><td>응용 프로그래머, 최종 사용자</td><td>DBA(데이터베이스 관리자)</td><td>DBA, 시스템 설계자</td></tr>
                        <tr><td>DDL</td><td>외부 DDL (CREATE VIEW 등)</td><td>개념 DDL (CREATE TABLE 등)</td><td>내부 DDL (CREATE INDEX, TABLESPACE 등)</td></tr>
                    </tbody>
                </table>

                <h3>제3장 각 스키마 단계 상세</h3>
                <h4>3.1 외부 스키마 (External Schema)</h4>
                <p>외부 스키마는 개별 사용자 또는 응용 프로그램이 데이터베이스를 바라보는 <span class="highlight">개인적 관점(Individual View)</span>을 정의한다. 하나의 데이터베이스에 대해 다수의 외부 스키마가 존재할 수 있으며, 각 외부 스키마는 전체 데이터베이스의 부분집합(Subset)에 해당한다.</p>
                <p><strong>핵심 특성:</strong></p>
                <ul>
                    <li><strong>데이터 추상화:</strong> 사용자는 자신에게 필요한 데이터만 논리적으로 접근하며, 나머지 데이터의 존재를 인지하지 않는다.</li>
                    <li><strong>보안 메커니즘:</strong> 뷰(View)를 통해 특정 컬럼이나 행에 대한 접근을 제한할 수 있다. 예컨대, 인사부서 사용자는 직원의 급여 정보에 접근할 수 있으나, 일반 부서 사용자의 외부 스키마에서는 급여 컬럼이 제외된다.</li>
                    <li><strong>데이터 독립성 확보:</strong> 개념 스키마가 변경되더라도 외부/개념 사상(E-C Mapping)을 수정함으로써 외부 스키마를 변경하지 않고 유지할 수 있다.</li>
                </ul>
                <p><strong>SQL 구현 예시:</strong></p>
                <pre><code>CREATE VIEW 인사부서_직원뷰 AS
SELECT 사번, 이름, 직급, 급여
FROM 직원
WHERE 부서 = '인사부';</code></pre>

                <h4>3.2 개념 스키마 (Conceptual Schema)</h4>
                <p>개념 스키마는 조직 전체의 관점에서 데이터베이스의 <span class="highlight">통합된 논리적 구조(Integrated Logical Structure)</span>를 정의한다. 데이터베이스당 정확히 하나의 개념 스키마가 존재하며, 모든 외부 스키마는 개념 스키마의 부분집합으로 유도된다.</p>
                <p><strong>핵심 특성:</strong></p>
                <ul>
                    <li><strong>엔터티와 관계:</strong> 조직에서 관리하는 모든 엔터티(Entity), 속성(Attribute), 관계(Relationship)를 정의한다.</li>
                    <li><strong>무결성 제약조건:</strong> 개체 무결성(Entity Integrity), 참조 무결성(Referential Integrity), 도메인 무결성(Domain Integrity) 등을 명시한다.</li>
                    <li><strong>물리적 구현 독립:</strong> 개념 스키마는 데이터의 논리적 구조만 정의하며, 물리적 저장 방식에 대해서는 기술하지 않는다.</li>
                </ul>
                <p><strong>DBA의 역할:</strong> 개념 스키마의 설계와 유지보수는 DBA의 핵심 업무이며, 데이터 모델링(ER 모델링, 정규화) 과정을 통해 구축된다.</p>

                <h4>3.3 내부 스키마 (Internal Schema)</h4>
                <p>내부 스키마는 데이터가 물리적 저장장치에 <span class="highlight">실제로 저장되는 방식(Physical Storage Structure)</span>을 정의한다. 성능 최적화와 저장 공간 효율성이 주요 관심사이다.</p>
                <p><strong>핵심 특성:</strong></p>
                <ul>
                    <li><strong>저장 레코드 형식:</strong> 필드의 데이터 타입, 크기, 순서를 정의한다.</li>
                    <li><strong>인덱스 구조:</strong> B-Tree, B+Tree, Hash, Bitmap 등의 인덱스 유형과 적용 대상을 결정한다.</li>
                    <li><strong>데이터 압축 및 암호화:</strong> 저장 공간 절약과 보안을 위한 물리적 처리 방식을 정의한다.</li>
                    <li><strong>저장 공간 할당:</strong> 테이블스페이스(Tablespace), 익스텐트(Extent), 블록(Block) 크기를 설정한다.</li>
                </ul>
                <p><strong>Oracle 구현 예시:</strong></p>
                <pre><code>CREATE TABLESPACE DATA_TBS
DATAFILE '/data/data01.dbf' SIZE 10G;

CREATE INDEX IDX_EMP_NAME
ON EMPLOYEE(NAME) TABLESPACE INDEX_TBS;</code></pre>

                <h3>제4장 스키마 간 사상(Mapping)과 데이터 독립성</h3>
                <h4>4.1 두 가지 사상(Mapping)</h4>
                <p>3단계 스키마 구조에서 데이터 독립성을 실현하는 핵심 메커니즘은 인접한 스키마 단계 간의 <span class="highlight">사상(Mapping)</span>이다. 사상은 상위 스키마의 요소를 하위 스키마의 요소로 변환하는 규칙을 정의한다.</p>
                <table>
                    <thead><tr><th>구분</th><th>외부/개념 사상 (E-C Mapping)</th><th>개념/내부 사상 (C-I Mapping)</th></tr></thead>
                    <tbody>
                        <tr><td>위치</td><td>외부 스키마 ↔ 개념 스키마</td><td>개념 스키마 ↔ 내부 스키마</td></tr>
                        <tr><td>역할</td><td>사용자 뷰와 전체 논리 구조 간 대응</td><td>논리적 구조와 물리적 저장 간 대응</td></tr>
                        <tr><td>변환 내용</td><td>뷰 정의, 컬럼 매핑, 접근 권한 매핑</td><td>테이블→저장 레코드, 컬럼→필드, 관계→포인터/인덱스</td></tr>
                        <tr><td>보장하는 독립성</td><td><strong>논리적 데이터 독립성</strong></td><td><strong>물리적 데이터 독립성</strong></td></tr>
                        <tr><td>변경 시나리오</td><td>개념 스키마에 컬럼 추가/삭제 시 뷰 재정의</td><td>인덱스 추가/변경, 파티셔닝 적용 시 매핑 수정</td></tr>
                    </tbody>
                </table>

                <h4>4.2 논리적 데이터 독립성 (Logical Data Independence)</h4>
                <p>논리적 데이터 독립성은 <span class="highlight">개념 스키마가 변경되더라도 외부 스키마(사용자 뷰)에 영향을 미치지 않는 성질</span>이다. 외부/개념 사상(E-C Mapping)을 수정하여 실현된다.</p>
                <p><strong>구체적 사례:</strong></p>
                <ul>
                    <li><strong>테이블 분리(수직 분할):</strong> 기존 <code>직원(사번, 이름, 부서, 급여, 주소)</code> 테이블을 <code>직원_기본(사번, 이름, 부서)</code>과 <code>직원_급여(사번, 급여)</code>로 분리하는 경우, 외부/개념 사상에서 기존 뷰를 두 테이블의 조인으로 재정의하면 기존 응용 프로그램은 수정 없이 동일하게 동작한다.</li>
                    <li><strong>컬럼 추가:</strong> 개념 스키마에 새로운 컬럼을 추가해도, 해당 컬럼을 사용하지 않는 기존 외부 스키마는 영향을 받지 않는다.</li>
                    <li><strong>엔터티 통합/분리:</strong> 두 개의 테이블을 하나로 통합하거나 반대로 분리해도, 뷰를 적절히 재정의하면 기존 응용 프로그램의 수정 없이 호환이 가능하다.</li>
                </ul>
                <div class="insight-box"><p class="text-sm text-amber-800"><strong>실현 난이도:</strong> 논리적 데이터 독립성은 물리적 데이터 독립성보다 <strong>실현이 어렵다</strong>. 개념 스키마의 변경은 데이터의 의미(Semantics) 자체의 변경을 수반하는 경우가 많아, 모든 외부 스키마에 대한 사상 재정의가 필요하기 때문이다.</p></div>

                <h4>4.3 물리적 데이터 독립성 (Physical Data Independence)</h4>
                <p>물리적 데이터 독립성은 <span class="highlight">내부 스키마가 변경되더라도 개념 스키마에 영향을 미치지 않는 성질</span>이다. 개념/내부 사상(C-I Mapping)을 수정하여 실현된다.</p>
                <p><strong>구체적 사례:</strong></p>
                <ul>
                    <li><strong>인덱스 변경:</strong> <code>직원</code> 테이블의 <code>이름</code> 컬럼에 B-Tree 인덱스를 추가하거나, 기존 인덱스를 Hash 인덱스로 변경해도 개념 스키마의 <code>직원</code> 테이블 정의는 변하지 않는다.</li>
                    <li><strong>저장장치 교체:</strong> HDD에서 SSD로 저장 매체를 교체하거나, 데이터 파일의 물리적 위치를 변경해도 논리적 스키마에는 영향이 없다.</li>
                    <li><strong>파티셔닝 적용:</strong> <code>주문</code> 테이블에 날짜 기반 Range Partitioning을 적용해도, SQL 질의에서 <code>주문</code> 테이블은 동일한 논리적 단위로 접근된다.</li>
                    <li><strong>데이터 압축:</strong> 저장 공간 절약을 위해 특정 테이블에 압축을 적용해도 개념 스키마에서의 데이터 조회 결과는 동일하다.</li>
                </ul>
                <p><strong>실현 용이도:</strong> 물리적 데이터 독립성은 논리적 데이터 독립성보다 <strong>실현이 상대적으로 용이하다</strong>. 대부분의 현대 DBMS가 내부적으로 개념/내부 사상을 자동으로 관리하기 때문이다.</p>

                <h4>4.4 두 가지 데이터 독립성 비교</h4>
                <table>
                    <thead><tr><th>비교 기준</th><th>논리적 데이터 독립성</th><th>물리적 데이터 독립성</th></tr></thead>
                    <tbody>
                        <tr><td>정의</td><td>개념 스키마 변경 시 외부 스키마에 영향 없음</td><td>내부 스키마 변경 시 개념 스키마에 영향 없음</td></tr>
                        <tr><td>사상</td><td>외부/개념 사상 (E-C Mapping)</td><td>개념/내부 사상 (C-I Mapping)</td></tr>
                        <tr><td>변경 주체</td><td>DBA (테이블 구조 변경)</td><td>DBA/시스템 (물리적 저장 구조 변경)</td></tr>
                        <tr><td>실현 난이도</td><td><strong>높음</strong> (의미적 변경 수반)</td><td><strong>낮음</strong> (물리적 변경만 수반)</td></tr>
                        <tr><td>영향 범위</td><td>모든 외부 스키마 검토 필요</td><td>개념 스키마에만 영향</td></tr>
                        <tr><td>대표 사례</td><td>테이블 분리/통합, 컬럼 추가/삭제</td><td>인덱스 변경, 파티셔닝, 저장장치 교체</td></tr>
                        <tr><td>DBMS 지원 수준</td><td>부분적 (뷰 메커니즘으로 지원)</td><td>대부분 자동 지원</td></tr>
                    </tbody>
                </table>

                <h3>제5장 장단점 및 한계</h3>
                <h4>5.1 3단계 스키마 구조의 장점</h4>
                <table>
                    <thead><tr><th>장점</th><th>상세 설명</th></tr></thead>
                    <tbody>
                        <tr><td>데이터 독립성 보장</td><td>각 수준의 변경이 다른 수준에 파급되지 않아 시스템 유지보수 비용 절감</td></tr>
                        <tr><td>보안 강화</td><td>외부 스키마를 통해 사용자별 접근 범위를 제한하여 데이터 보안 확보</td></tr>
                        <tr><td>데이터 통합 관리</td><td>개념 스키마를 통해 조직 전체의 데이터를 일원적으로 관리하여 중복 제거</td></tr>
                        <tr><td>성능 최적화 유연성</td><td>내부 스키마 수준에서 인덱스, 파티셔닝 등을 자유롭게 조정 가능</td></tr>
                        <tr><td>다양한 사용자 뷰 지원</td><td>동일한 데이터를 다양한 관점(마케팅, 재무, 인사 등)에서 접근 가능</td></tr>
                    </tbody>
                </table>

                <h4>5.2 한계 및 비판</h4>
                <p>3단계 스키마 구조는 이상적인 참조 모델(Reference Model)이며, 실제 DBMS에서 완벽하게 구현되지는 않는다.</p>
                <table>
                    <thead><tr><th>한계</th><th>설명</th></tr></thead>
                    <tbody>
                        <tr><td>완벽한 논리적 독립성의 어려움</td><td>개념 스키마의 대규모 변경 시 뷰 재정의만으로 모든 호환성을 보장하기 어려움</td></tr>
                        <tr><td>성능 오버헤드</td><td>다중 사상(Mapping)으로 인한 질의 변환 오버헤드 발생 가능</td></tr>
                        <tr><td>NoSQL의 도전</td><td>MongoDB 등 스키마리스(Schemaless) DB는 고정된 개념 스키마 자체를 부정</td></tr>
                        <tr><td>실시간 스키마 진화</td><td>대규모 시스템에서 무중단 스키마 변경(Online DDL)은 여전히 도전적 과제</td></tr>
                    </tbody>
                </table>

                <h3>제6장 현대적 발전과 변형</h3>
                <h4>6.1 데이터 레이크하우스와 스키마 전략</h4>
                <p>현대의 데이터 레이크하우스(Data Lakehouse) 아키텍처에서 3단계 스키마 구조의 정신은 다른 형태로 계승되고 있다.</p>
                <table>
                    <thead><tr><th>전통적 RDBMS</th><th>데이터 레이크하우스</th><th>계승 관점</th></tr></thead>
                    <tbody>
                        <tr><td>외부 스키마</td><td>Materialized View, BI 계층</td><td>사용자별 분석 뷰 제공</td></tr>
                        <tr><td>개념 스키마</td><td>Delta Lake의 테이블 메타데이터</td><td>스키마 진화(Schema Evolution) 지원</td></tr>
                        <tr><td>내부 스키마</td><td>Parquet/ORC 파일 포맷, 파티셔닝</td><td>물리적 저장 최적화</td></tr>
                        <tr><td>외부/개념 사상</td><td>dbt(Data Build Tool) 변환 계층</td><td>논리적 변환 규칙 관리</td></tr>
                        <tr><td>개념/내부 사상</td><td>Iceberg/Delta Lake 메타데이터</td><td>파일 → 테이블 사상 자동 관리</td></tr>
                    </tbody>
                </table>
                <div class="insight-box"><p class="text-sm text-amber-800"><strong>핵심 통찰:</strong> "Schema-on-Read"와 "Schema-on-Write"의 구분은 3단계 스키마 구조에서 개념 스키마와 내부 스키마의 결합도를 조절하는 현대적 접근법이다.</p></div>

                <h4>6.2 NoSQL과 스키마 유연성</h4>
                <p>MongoDB, Cassandra 등 NoSQL 데이터베이스는 고정된 개념 스키마 대신 유연한 스키마(Flexible Schema)를 채택하였다. 이는 3단계 스키마 구조를 부정하는 것이 아니라, 개념 스키마의 정의 시점을 <strong>설계 시(Design-time)</strong>에서 <strong>실행 시(Runtime)</strong>로 이동시킨 것으로 해석할 수 있다. 실제로 MongoDB Atlas는 Schema Validation 기능으로 개념 스키마에 해당하는 제약조건을 Runtime에 적용할 수 있다.</p>

                <h3>제7장 시험 출제 관점</h3>
                <h4>7.1 기출 연계 포인트</h4>
                <p>데이터 독립성과 3단계 스키마는 정보관리기술사 1교시에서 빈출되는 핵심 토픽이다. 단독 출제는 물론, 데이터베이스 설계(정규화/반정규화), 데이터 모델링, 데이터 거버넌스 등과 결합하여 2교시에서도 출제될 수 있다.</p>

                <h4>7.2 답안 작성 전략</h4>
                <p><strong>차별화 전략:</strong> 단순히 3단계를 나열하는 것은 합격권이다. 차별화를 위해 ① 구조도를 직접 그리고, ② 논리적/물리적 데이터 독립성의 차이를 구체적 사례로 설명하며, ③ 현대적 아키텍처(Data Lakehouse, NoSQL)와 연결하면 깊이가 달라진다.</p>
                <p><strong>분량 비중 가이드 (1교시 답안 기준):</strong> 서론 15% / 본론 75% / 결론 10%</p>

                <h4>7.3 연관 이론</h4>
                <p><strong>ANSI/SPARC 보고서 (1975):</strong> 3단계 스키마 아키텍처의 원본. 데이터 독립성을 DBMS의 핵심 설계 원칙으로 공식화한 문서이다.</p>
                <p><strong>E.F. Codd의 12가지 규칙 (1985):</strong> Codd는 관계형 DBMS가 충족해야 할 12가지 규칙을 제시하였으며, 그 중 Rule 8(Physical Data Independence)과 Rule 9(Logical Data Independence)가 직접적으로 데이터 독립성을 명시한다.</p>
                <p><strong>추상화 원칙 (Abstraction Principle):</strong> 3단계 스키마 구조는 컴퓨터 과학의 보편적 설계 원칙인 추상화(Abstraction)의 데이터베이스 적용이다. OSI 7계층 모델, TCP/IP 4계층 모델도 동일한 추상화 원칙에 기반한다.</p>

            </div><!-- /textbook-content -->
        </div>
    </div>

    <!-- ===== 강의 스크립트 탭 (멘토 전용) ===== -->
    <div id="script" class="hidden">
        <div class="bg-white rounded-xl shadow-sm p-6 sm:p-8 animate-fade-in">
            <div class="flex items-center gap-3 mb-4">
                <h2 class="text-xl sm:text-2xl font-bold text-gray-900">🎬 강의 스크립트</h2>
                <span class="bg-amber-100 text-amber-800 text-xs font-bold px-3 py-1 rounded-full border border-amber-300">🔒 멘토 전용</span>
            </div>
            <div class="bg-amber-50 border border-amber-200 rounded-lg p-4 mb-6 text-sm text-amber-800">
                <strong>안내:</strong> 이 탭은 멘토 전용 콘텐츠입니다. URL에 <code class="bg-amber-100 px-1 rounded">?mentor=true</code> 파라미터를 추가하면 접근할 수 있습니다.
            </div>
            <div class="textbook-content">
                <h4>🎬 도입부 — 약 3분</h4>
                <p>안녕하세요, 여러분. 오늘은 데이터베이스의 가장 근본적인 토픽을 다뤄보겠습니다. "데이터 독립성과 3단계 스키마 구조"예요.</p>
                <p>이 토픽이 왜 중요하냐면, 데이터베이스가 존재하는 이유 그 자체를 설명하는 개념이거든요. 파일 시스템을 쓰면 안 되나? 왜 DBMS가 필요한 거지? 이 질문에 대한 답이 바로 데이터 독립성이에요.</p>
                <p>시험에서도 빈출 토픽이고요, 1교시에서 단독으로 나올 수도 있고, 2교시에서 데이터 모델링이나 정규화 문제와 결합해서 나올 수도 있습니다. 특히 "ANSI/SPARC 3단계 스키마를 도식화하고, 논리적/물리적 데이터 독립성의 차이를 설명하시오" 이런 형태로 많이 나와요.</p>
                <p>오늘 목표는 이 토픽을 답안지에 깔끔하게 쓸 수 있을 정도로 완전히 정리하는 겁니다. 특히 도식을 어떻게 그리고, 두 가지 독립성을 어떻게 구분해서 쓰는지까지 실전적으로 다루겠습니다.</p>

                <h4>🎬 핵심 설명 — 3단계 스키마 구조 (약 7분)</h4>
                <p><strong>파일 시스템에서 DBMS로</strong></p>
                <p>자, 먼저 왜 데이터 독립성이 필요한지부터 짚어봅시다. 이거 이해하려면 옛날 이야기를 좀 해야 돼요.</p>
                <p>옛날 파일 시스템 시절을 상상해보세요. COBOL로 짠 급여 프로그램이 있어요. 이 프로그램은 직원 데이터 파일을 직접 읽거든요. 파일의 레코드 구조가 "사번(4바이트), 이름(20바이트), 급여(8바이트)" 이런 식으로 딱 정해져 있는 거예요. 그런데 어느 날 "주소" 필드를 추가해야 한다고 해보세요. 뭐가 바뀌죠? 파일 구조가 바뀌니까, 이 파일을 읽는 모든 프로그램을 다 수정해야 해요. 프로그램이 10개면 10개 다, 100개면 100개 다 바꿔야 하는 거예요. 이게 데이터 종속성 문제입니다. 엄청나게 비효율적이잖아요?</p>
                <p>E.F. Codd라는 분이 1970년에 이 문제에 대한 근본적인 해결책을 제시했어요. 데이터의 논리적 표현과 물리적 저장을 분리하자는 거죠. "데이터가 어떻게 저장되어 있든, 사용자는 논리적인 구조만 보면 된다." 이게 관계형 모델의 시작이고, 데이터 독립성의 이론적 토대가 됩니다.</p>
                <p><strong>ANSI/SPARC 3단계 — <span class="highlight">"외개내"</span>로 외우세요</strong></p>
                <p>그리고 1975년에 ANSI/SPARC 위원회에서 이 아이디어를 체계적인 아키텍처로 정리했어요. 바로 3단계 스키마 구조입니다. <span class="highlight">"외개내"</span>로 외우세요. 외부, 개념, 내부.</p>
                <p>답안지에 이 구조도를 반드시 그려야 합니다. 맨 위에 사용자들이 있고, 그 아래 외부 스키마가 여러 개, 중간에 개념 스키마 하나, 맨 아래 내부 스키마 하나, 그 아래 물리적 저장장치. 이런 수직적 계층도예요.</p>
                <p>외부 스키마가 뭐냐면, 개별 사용자가 보는 뷰예요. 인사부서 사용자는 직원의 급여까지 보이고, 일반 부서 사용자는 급여가 안 보이고. 같은 데이터베이스인데 사용자마다 보이는 게 다른 거죠. SQL에서 CREATE VIEW가 바로 이 외부 스키마를 정의하는 거예요.</p>
                <p>개념 스키마는 조직 전체의 관점에서 본 통합된 논리 구조예요. CREATE TABLE로 정의하는 그 테이블 구조가 개념 스키마입니다. 데이터베이스당 딱 하나만 존재해요. DBA가 관리하는 거죠. 엔터티, 관계, 무결성 제약조건이 여기에 다 정의됩니다.</p>
                <p>내부 스키마는 데이터가 실제로 디스크에 어떻게 저장되는지를 정의해요. 인덱스를 B-Tree로 할 건지, 테이블스페이스를 어떻게 할 건지, 이런 물리적인 것들이요.</p>
                <p>여기서 중요한 포인트가 하나 있어요. 각 단계의 개수를 주목하세요. 외부 스키마는 여러 개 있을 수 있어요. 사용자마다 다른 뷰를 쓰니까요. 하지만 개념 스키마는 딱 하나, 내부 스키마도 딱 하나. 이 숫자를 외워두세요.</p>
                <p>그리고 정말 중요한 건 이 세 단계 사이에 <span class="highlight">사상(Mapping)</span>이 있다는 거예요. 외부-개념 사상, 개념-내부 사상. 이 사상이 바로 데이터 독립성을 실현하는 핵심 메커니즘이에요.</p>

                <h4>🎬 핵심 설명 — 데이터 독립성 (약 7분)</h4>
                <p><strong>논리적 독립성 vs 물리적 독립성</strong></p>
                <p>자, 이제 데이터 독립성을 자세히 봅시다. 두 가지예요. 논리적 데이터 독립성하고 물리적 데이터 독립성.</p>
                <p>물리적 데이터 독립성부터 가볼게요, 이게 더 이해하기 쉬우니까. 내부 스키마가 바뀌어도 개념 스키마에 영향이 없다는 거예요. 예를 들어볼게요. 직원 테이블의 이름 컬럼에 인덱스를 추가했다고 해보세요. B-Tree 인덱스를 달았어요. 그러면 검색 속도는 빨라지겠죠? 하지만 개념 스키마의 직원 테이블 구조는 변한 게 아무것도 없어요.</p>
                <p>논리적 데이터 독립성은 좀 더 어려운 개념이에요. 개념 스키마가 바뀌어도 외부 스키마에 영향이 없다는 거거든요. 예를 들어, 직원 테이블을 두 개로 쪼갠다고 해보세요. 직원_기본과 직원_급여로. 이때 기존에 "SELECT 사번, 이름, 급여 FROM 직원"이라고 쓰던 프로그램은 어떻게 하죠? 외부/개념 사상을 수정해서, 기존 뷰를 두 테이블의 조인으로 재정의하면 됩니다.</p>
                <p>여기서 시험에서 자주 묻는 포인트가 있어요. <strong>"논리적 독립성이 물리적 독립성보다 실현이 어렵다."</strong> 이거 왜 그럴까요?</p>
                <p>물리적 변경은 데이터의 의미가 바뀌는 게 아니잖아요? 저장 방식만 바뀌는 거예요. 대부분의 DBMS가 이걸 내부적으로 자동 관리해주거든요. 근데 논리적 변경은 달라요. 테이블 구조가 바뀌면 데이터의 의미 자체가 바뀌는 거예요. 모든 외부 스키마를 일일이 검토하고 뷰를 재정의해야 하거든요. 그래서 <span class="highlight">"논높물낮"</span>, 논리적은 높고 물리적은 낮다, 이렇게 외우시면 됩니다.</p>
                <p><strong>Codd의 12가지 규칙과 연결</strong></p>
                <p>E.F. Codd가 1985년에 관계형 DBMS가 충족해야 할 12가지 규칙을 발표했거든요. 그 중에 Rule 8이 Physical Data Independence, Rule 9가 Logical Data Independence예요. 이걸 답안에 쓰면 이론적 깊이가 인정됩니다.</p>
                <p>그리고 3단계 스키마 구조를 OSI 7계층과 비교해서 설명하면 아주 좋아요. 둘 다 추상화 원칙(Abstraction Principle)을 적용한 거거든요.</p>

                <h4>🎬 답안 작성 팁 — 약 3분</h4>
                <p>서론에서는 파일 시스템의 데이터 종속성 문제를 간략히 언급하고, "이를 해결하기 위해 ANSI/SPARC는 1975년 3단계 스키마 아키텍처를 제안하였다"로 연결하세요. 분량은 15%.</p>
                <p>본론 1에서는 반드시 3단계 스키마 구조도를 그리세요. 이게 없으면 감점이라고 생각하시면 됩니다. 분량 30%.</p>
                <p>본론 2에서는 두 가지 데이터 독립성을 비교합니다. 핵심은 각각의 구체적 사례를 반드시 하나씩 들어주는 거예요. 그리고 <strong>"논리적 독립성이 더 실현하기 어렵다"</strong>는 포인트를 꼭 써주세요. 분량 30%.</p>
                <p>본론 3에서는 현대적 맥락을 연결하세요. 분량 15%.</p>
                <p>결론은 "데이터 독립성은 50년이 지난 현재에도 유효한 설계 원칙이며, NoSQL의 스키마 유연성도 이 원칙의 현대적 변형으로 이해할 수 있다" 정도로 마무리. 분량 10%.</p>

                <h4>🎬 마무리 — 약 2분</h4>
                <p>핵심 암기 포인트 다시 한번 짚겠습니다. 3단계 스키마 순서는 <span class="highlight">"외개내"</span>. 두 가지 사상은 <span class="highlight">"외개사/개내사"</span>. 실현 난이도는 <span class="highlight">"논높물낮"</span>. 이 세 가지는 절대 놓치지 마세요.</p>
                <p>답안에서 차별화하려면 두 가지를 꼭 하세요. 첫째, 구조도를 직접 그리세요. 둘째, Codd의 Rule 8, 9를 한 줄이라도 언급하세요. 데이터 레이크하우스에서 3단계 스키마가 어떻게 계승되는지 언급하면 시의성까지 확보됩니다.</p>
                <p>이 토픽은 정규화/반정규화, 데이터 모델링, 데이터 거버넌스 등 다른 DB 토픽과 연결고리가 정말 많아요. 토픽 간 연결을 의식하면서 공부하면 효율이 훨씬 올라갑니다.</p>
                <p>여러분, 데이터 독립성은 50년 전에 나온 개념인데 아직까지 유효해요. 그만큼 본질적인 원리라는 뜻이에요. 이 원리를 확실히 잡아놓으면 DB 영역 전체가 편해집니다. 오늘도 수고 많으셨고, 다음 강의에서 뵙겠습니다. 감사합니다.</p>
            </div>
        </div>
    </div>

    <!-- ===== 탭: 퀴즈 & 암기 ===== -->
    <section id="quiz" class="hidden space-y-6">
        <div class="bg-white rounded-xl shadow-sm p-6 sm:p-8 border-t-4 border-indigo-600">
            <h2 class="text-2xl font-bold text-gray-900 mb-4">암기 노트 &amp; AI 실전 퀴즈</h2>
            <p class="text-gray-600 mb-6">데이터 독립성과 3단계 스키마 구조 답안 작성을 위한 핵심 요약과 AI 출제 문제를 풀어보세요.</p>

            <!-- AI 실전 퀴즈 영역 -->
            <div class="bg-indigo-50 rounded-xl p-6 border border-indigo-100 mb-8">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="font-bold text-indigo-900 text-lg flex items-center"><span class="mr-2">🧠</span> AI 실전 문제 생성</h3>
                    <button onclick="generateQuiz()" id="btn-quiz-gen" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg text-sm font-medium shadow-sm transition-colors flex items-center gap-2"><span>✨ 새로운 문제 생성</span></button>
                </div>
                <div id="quiz-loading" class="hidden py-8 text-center">
                    <div class="typing-indicator flex justify-center mb-2"><span></span><span></span><span></span></div>
                    <p class="text-indigo-600 text-sm">AI가 문제를 출제하고 있습니다...</p>
                </div>
                <div id="quiz-container" class="hidden space-y-4">
                    <div class="bg-white p-5 rounded-lg shadow-sm border border-indigo-100">
                        <div class="flex items-start gap-2 mb-4">
                            <span id="quiz-type-badge" class="bg-indigo-100 text-indigo-800 text-xs font-bold px-2 py-1 rounded whitespace-nowrap mt-1">객관식</span>
                            <p id="quiz-question" class="font-bold text-gray-800 text-lg"></p>
                        </div>
                        <div id="quiz-options" class="space-y-2"></div>
                        <div id="quiz-input-area" class="hidden mt-4">
                            <div class="flex gap-2">
                                <input type="text" id="quiz-answer-input" placeholder="정답을 입력하세요" class="flex-grow border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                <button onclick="checkShortAnswer()" id="btn-short-submit" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-bold">제출</button>
                            </div>
                        </div>
                    </div>
                    <div id="quiz-feedback" class="hidden bg-white p-5 rounded-lg border-l-4"></div>
                </div>
                <div id="quiz-placeholder" class="text-center py-8 text-gray-500 border-2 border-dashed border-indigo-200 rounded-lg">
                    <p>&#39;새로운 문제 생성&#39; 버튼을 눌러 실력을 점검해보세요.</p>
                </div>
            </div>

            <!-- 암기 노트: 교재 제2부 전체 재현 -->
            <section class="textbook-content">
                <h3 style="margin-top: 3rem; padding-top: 2rem; border-top: 2px solid #e5e7eb;">제2부 — 암기 요약 자료</h3>
                <p class="text-xs text-gray-400 mb-4">서술형 답안지 작성을 위한 핵심 암기 포인트</p>

                <h4>1. 한 줄 정의</h4>
                <table>
                    <thead><tr><th>토픽</th><th>한 줄 정의</th></tr></thead>
                    <tbody>
                        <tr><td><strong>데이터 독립성</strong></td><td>하위 단계 데이터 구조 변경 시 상위 단계에 영향을 주지 않는 성질로, 3단계 스키마 간 사상(Mapping)을 통해 실현 (ANSI/SPARC, 1975)</td></tr>
                        <tr><td><strong>3단계 스키마 구조</strong></td><td>데이터를 외부(사용자 뷰)-개념(통합 논리)-내부(물리 저장)의 3수준으로 분리하여 데이터 독립성을 구조적으로 보장하는 DBMS 참조 아키텍처</td></tr>
                    </tbody>
                </table>

                <h4>2. 핵심 키워드 맵</h4>
                <div class="insight-box">
                    <p><strong>3단계 스키마 키워드:</strong> ANSI/SPARC 1975 / 외부-개념-내부 / E-C Mapping / C-I Mapping / 뷰(View) / DBA / DDL / 메타데이터 / 데이터 사전</p>
                    <p><strong>데이터 독립성 키워드:</strong> 논리적 독립성(Logical) / 물리적 독립성(Physical) / Codd 12규칙(Rule 8, 9) / 사상(Mapping) / 변경 파급 차단 / Schema-on-Read / Schema-on-Write</p>
                </div>

                <h4>3. 두문자어 암기법</h4>
                <ul>
                    <li>3단계 스키마 순서: <span class="highlight">"외개내"</span> (외부 → 개념 → 내부)</li>
                    <li>두 가지 사상: <span class="highlight">"외개사 / 개내사"</span> (외부-개념 사상 = 논리적 독립성 / 개념-내부 사상 = 물리적 독립성)</li>
                    <li>데이터 독립성 실현 난이도: <span class="highlight">"논높물낮"</span> (논리적 = 높음, 물리적 = 낮음)</li>
                    <li>외부 스키마 핵심 기능: <span class="highlight">"추보다"</span> (추상화-보안-다양한 뷰)</li>
                </ul>

                <h4>4. 골격 답안 구조</h4>
                <p><strong>문제 유형: 데이터 독립성과 3단계 스키마 구조를 설명하시오</strong></p>
                <table>
                    <thead><tr><th>구분</th><th>핵심 내용</th><th>분량 비중</th></tr></thead>
                    <tbody>
                        <tr><td><strong>서론</strong></td><td>파일 시스템의 데이터 종속성 문제 → ANSI/SPARC 3단계 스키마 → 데이터 독립성의 정의</td><td>15%</td></tr>
                        <tr><td><strong>본론 1</strong></td><td>3단계 스키마 구조 도식 + 각 단계(외부/개념/내부) 설명 (비교표 활용)</td><td>30%</td></tr>
                        <tr><td><strong>본론 2</strong></td><td>두 가지 사상(E-C / C-I) + 논리적/물리적 데이터 독립성 비교 (구체적 사례 포함)</td><td>30%</td></tr>
                        <tr><td><strong>본론 3</strong></td><td>현대적 관점: 데이터 레이크하우스에서의 계승 + Codd 12규칙 연계</td><td>15%</td></tr>
                        <tr><td><strong>결론</strong></td><td>데이터 독립성의 현대적 유효성 + NoSQL/빅데이터 시대에서의 진화 방향</td><td>10%</td></tr>
                    </tbody>
                </table>

                <h4>5. 필수 도식</h4>
                <p><strong>도식 1: ANSI/SPARC 3단계 스키마 아키텍처</strong></p>
<pre><code>[답안지에 계층도로 표현]
외부 스키마(다수) → E-C Mapping → 개념 스키마(1개) → C-I Mapping → 내부 스키마(1개) → 물리적 저장장치
각 수준의 이해관계자 표시: 사용자 / DBA / 시스템</code></pre>
                <p><strong>도식 2: 논리적 vs 물리적 데이터 독립성 비교</strong></p>
<pre><code>[답안지에 비교표로 표현]
비교 기준 6가지: 정의, 사상 위치, 변경 주체, 난이도, 영향 범위, 대표 사례</code></pre>

                <h4>6. 차별화 포인트</h4>
                <ul>
                    <li>Codd의 12가지 규칙(Rule 8, 9)을 인용하여 데이터 독립성이 관계형 모델의 공식적 요구사항임을 제시하면 이론적 근거가 강화된다.</li>
                    <li>3단계 스키마를 OSI 7계층과 대비하여 &quot;추상화 원칙의 DB 적용&quot;으로 설명하면 CS 전반에 대한 통찰력을 보여줄 수 있다.</li>
                    <li>현대 Data Lakehouse에서의 계승(dbt = E-C Mapping, Delta Lake = C-I Mapping)을 연결하면 시의성이 확보된다.</li>
                    <li>논리적 독립성이 물리적 독립성보다 실현이 어려운 이유를 &quot;의미적(Semantic) 변경 수반&quot;으로 명쾌하게 설명하면 깊이가 달라진다.</li>
                </ul>
            </section>
        </div>
    </section>

    </main>

    <!-- FOOTER -->
    <footer class="bg-white mt-12 py-8 border-t border-gray-200">
        <div class="max-w-6xl mx-auto px-4 text-center">
            <div class="flex flex-col md:flex-row justify-center items-center gap-2 md:gap-6 text-sm text-gray-600 mb-3 font-medium">
                <div class="flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-indigo-500"></span>
                    <span>박교익PE (132회 정보관리기술사, dr.code92@gmail.com)</span>
                </div>
            </div>
            <p class="text-xs text-gray-400">Copyright &copy; KPC 정보관리기술사 ZIP-UP 심화반. All rights reserved.</p>
        </div>
    </footer>

    <!-- 채팅 사이드바 -->
    <div id="chat-sidebar" class="fixed top-0 right-0 w-80 sm:w-96 h-full bg-white shadow-2xl z-50 flex flex-col closed">
        <div class="p-4 bg-indigo-600 text-white flex justify-between items-center">
            <span class="font-bold text-sm">AI 튜터 채팅</span>
            <button onclick="toggleChat()" class="text-white hover:text-indigo-200 text-xl leading-none">&times;</button>
        </div>
        <div id="chatMessages" class="flex-grow overflow-y-auto p-4 flex flex-col space-y-2" style="max-height:calc(100vh - 140px);">
            <div class="chat-msg ai">안녕하세요! 데이터 독립성과 3단계 스키마에 대해 무엇이든 질문해주세요.</div>
        </div>
        <div id="typingIndicator" class="hidden px-4 pb-2"><div class="typing-indicator"><span></span><span></span><span></span></div></div>
        <div class="p-3 border-t flex gap-2">
            <input type="text" id="chatInput" class="flex-grow border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-400" placeholder="질문을 입력하세요..." onkeydown="if(event.key==='Enter')sendChat()">
            <button onclick="sendChat()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-indigo-700 transition">전송</button>
        </div>
    </div>

    <!-- 플로팅 채팅 버튼 -->
    <button onclick="toggleChat()" class="fixed bottom-6 right-6 bg-indigo-600 text-white w-14 h-14 rounded-full shadow-lg hover:bg-indigo-700 transition flex items-center justify-center text-2xl z-40" title="AI 튜터 채팅">
        &#128172;
    </button>

    <!-- API 설정 모달 -->
    <div id="settings-modal" class="hidden fixed inset-0 bg-black bg-opacity-40 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-xl p-6 w-full max-w-md">
            <h3 class="font-bold text-lg text-gray-900 mb-4">API Key 설정</h3>
            <p class="text-sm text-gray-500 mb-3">Gemini API Key를 입력하면 AI 퀴즈와 채팅 기능을 사용할 수 있습니다.</p>
            <input type="password" id="apiKeyInput" class="w-full border border-gray-300 rounded-lg px-4 py-2 text-sm mb-4 focus:outline-none focus:ring-2 focus:ring-indigo-400" placeholder="Gemini API Key 입력">
            <div class="flex gap-2 justify-end">
                <button onclick="toggleSettings()" class="px-4 py-2 text-sm text-gray-500 hover:text-gray-700 transition">취소</button>
                <button onclick="saveSettings()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-indigo-700 transition">저장</button>
            </div>
        </div>
    </div>

    <script>
    // ── API Key 관리 ──
    let geminiKey = localStorage.getItem('geminiKey') || new URLSearchParams(window.location.search).get('key') || '';
    function toggleSettings() {
        var m = document.getElementById('settings-modal');
        m.classList.toggle('hidden');
        if (!m.classList.contains('hidden')) document.getElementById('apiKeyInput').value = geminiKey;
    }
    function saveSettings() {
        geminiKey = document.getElementById('apiKeyInput').value.trim();
        if (geminiKey) localStorage.setItem('geminiKey', geminiKey);
        toggleSettings();
    }

    // ── 멘토 모드 ──
    var isMentorMode = new URLSearchParams(window.location.search).get('mentor') === 'true';
    if (isMentorMode) {
        document.getElementById('nav-script').classList.remove('hidden');
    }
    var sections = isMentorMode
        ? ['overview','schema','independence','modern','textbook','script','quiz']
        : ['overview','schema','independence','modern','textbook','quiz'];

    // ── 탭 네비게이션 ──
    function navTo(id) {
        document.querySelectorAll('.nav-item').forEach(function(el) {
            el.classList.remove('active','text-indigo-600');
        });
        document.getElementById('nav-' + id).classList.add('active','text-indigo-600');
        sections.forEach(function(s) {
            document.getElementById(s).classList.add('hidden');
        });
        document.getElementById(id).classList.remove('hidden');
        window.scrollTo({top:0, behavior:'smooth'});
    }

    // ── 3단계 스키마 클릭 확장 ──
    var schemaDetails = {
        'external': {
            title: '외부 스키마 (External Schema)',
            colorClass: 'text-indigo-700',
            content: '<p class="text-sm text-gray-700 leading-relaxed mb-3">개별 사용자 또는 응용 프로그램이 데이터베이스를 바라보는 <strong>개인적 관점(Individual View)</strong>을 정의한다.</p>'
                + '<p class="text-sm text-gray-700 leading-relaxed mb-3"><strong>핵심 특성:</strong></p>'
                + '<ul class="text-sm text-gray-700 list-disc pl-5 space-y-1 mb-3"><li><strong>데이터 추상화:</strong> 필요한 데이터만 논리적으로 접근</li><li><strong>보안 메커니즘:</strong> 뷰(View)로 특정 컬럼/행 접근 제한</li><li><strong>다수 존재 가능:</strong> 사용자/응용별로 서로 다른 외부 스키마</li></ul>'
                + '<p class="text-sm text-gray-700 mb-1"><strong>SQL 예시:</strong></p>'
                + '<pre class="text-xs bg-slate-50 p-3 rounded-lg border"><code>CREATE VIEW 인사부서_직원뷰 AS\nSELECT 사번, 이름, 직급, 급여\nFROM 직원 WHERE 부서 = &#39;인사부&#39;;</code></pre>'
        },
        'conceptual': {
            title: '개념 스키마 (Conceptual Schema)',
            colorClass: 'text-green-700',
            content: '<p class="text-sm text-gray-700 leading-relaxed mb-3">조직 전체의 관점에서 데이터베이스의 <strong>통합된 논리적 구조</strong>를 정의한다. 데이터베이스당 정확히 1개.</p>'
                + '<p class="text-sm text-gray-700 leading-relaxed mb-3"><strong>핵심 특성:</strong></p>'
                + '<ul class="text-sm text-gray-700 list-disc pl-5 space-y-1 mb-3"><li><strong>엔터티와 관계:</strong> 모든 Entity, Attribute, Relationship 정의</li><li><strong>무결성 제약조건:</strong> 개체/참조/도메인 무결성 명시</li><li><strong>물리적 구현 독립:</strong> 논리적 구조만 정의, 물리 저장 방식은 기술하지 않음</li></ul>'
                + '<p class="text-sm text-gray-700"><strong>DBA의 역할:</strong> ER 모델링, 정규화를 통해 설계·유지보수</p>'
        },
        'internal': {
            title: '내부 스키마 (Internal Schema)',
            colorClass: 'text-purple-700',
            content: '<p class="text-sm text-gray-700 leading-relaxed mb-3">데이터가 물리적 저장장치에 <strong>실제로 저장되는 방식</strong>을 정의한다. 성능 최적화와 저장 공간 효율성이 주요 관심사.</p>'
                + '<p class="text-sm text-gray-700 leading-relaxed mb-3"><strong>핵심 특성:</strong></p>'
                + '<ul class="text-sm text-gray-700 list-disc pl-5 space-y-1 mb-3"><li><strong>저장 레코드 형식:</strong> 필드 타입, 크기, 순서</li><li><strong>인덱스 구조:</strong> B-Tree, B+Tree, Hash, Bitmap</li><li><strong>압축/암호화:</strong> 저장 공간 절약, 보안</li><li><strong>저장 공간 할당:</strong> Tablespace, Extent, Block</li></ul>'
                + '<p class="text-sm text-gray-700 mb-1"><strong>Oracle 예시:</strong></p>'
                + '<pre class="text-xs bg-slate-50 p-3 rounded-lg border"><code>CREATE TABLESPACE DATA_TBS\nDATAFILE &#39;/data/data01.dbf&#39; SIZE 10G;\n\nCREATE INDEX IDX_EMP_NAME\nON EMPLOYEE(NAME) TABLESPACE INDEX_TBS;</code></pre>'
        }
    };
    function updateSchemaDetail(key) {
        document.querySelectorAll('#schema .tech-block').forEach(function(el) { el.classList.remove('selected'); });
        document.getElementById('block-' + key).classList.add('selected');
        var d = schemaDetails[key];
        document.getElementById('schema-detail-content').innerHTML = '<h4 class="text-lg font-bold mb-3 ' + d.colorClass + '">' + d.title + '</h4>' + d.content;
    }

    // ── 데이터 독립성 클릭 확장 ──
    var indepDetails = {
        'logical': {
            title: '논리적 데이터 독립성 (Logical Data Independence)',
            colorClass: 'text-blue-700',
            content: '<div class="def-box mb-3"><p>개념 스키마가 변경되더라도 외부 스키마(사용자 뷰)에 영향을 미치지 않는 성질. 외부/개념 사상(E-C Mapping) 수정으로 실현.</p></div>'
                + '<p class="text-sm text-gray-700 leading-relaxed mb-3"><strong>구체적 사례:</strong></p>'
                + '<ul class="text-sm text-gray-700 list-disc pl-5 space-y-2 mb-3">'
                + '<li><strong>테이블 분리:</strong> 직원 테이블을 직원_기본+직원_급여로 분리 → 뷰를 조인으로 재정의 → 기존 응용은 수정 없이 동작</li>'
                + '<li><strong>컬럼 추가:</strong> 새 컬럼 추가 시, 해당 컬럼을 사용하지 않는 기존 외부 스키마는 영향 없음</li>'
                + '<li><strong>엔터티 통합/분리:</strong> 뷰를 재정의하면 기존 프로그램과 호환 가능</li></ul>'
                + '<div class="bg-red-50 rounded-lg p-3 border border-red-200 text-sm"><strong class="text-red-700">실현 난이도: 높음</strong> — 데이터 의미(Semantics) 자체가 변경되므로, 모든 외부 스키마의 사상 재정의 필요</div>'
        },
        'physical': {
            title: '물리적 데이터 독립성 (Physical Data Independence)',
            colorClass: 'text-orange-700',
            content: '<div class="def-box mb-3"><p>내부 스키마가 변경되더라도 개념 스키마에 영향을 미치지 않는 성질. 개념/내부 사상(C-I Mapping) 수정으로 실현.</p></div>'
                + '<p class="text-sm text-gray-700 leading-relaxed mb-3"><strong>구체적 사례:</strong></p>'
                + '<ul class="text-sm text-gray-700 list-disc pl-5 space-y-2 mb-3">'
                + '<li><strong>인덱스 변경:</strong> B-Tree → Hash 인덱스 변경 시 테이블 정의 불변</li>'
                + '<li><strong>저장장치 교체:</strong> HDD → SSD 교체, 파일 위치 변경에 논리 스키마 영향 없음</li>'
                + '<li><strong>파티셔닝 적용:</strong> Range Partitioning 적용해도 SQL 질의는 동일</li>'
                + '<li><strong>데이터 압축:</strong> 압축 적용해도 조회 결과 동일</li></ul>'
                + '<div class="bg-green-50 rounded-lg p-3 border border-green-200 text-sm"><strong class="text-green-700">실현 난이도: 낮음</strong> — 대부분의 현대 DBMS가 개념/내부 사상을 자동 관리</div>'
        }
    };
    function updateIndepDetail(key) {
        document.querySelectorAll('#independence .tech-block').forEach(function(el) { el.classList.remove('selected'); });
        document.getElementById('block-' + key).classList.add('selected');
        var d = indepDetails[key];
        document.getElementById('indep-detail-content').innerHTML = '<h4 class="text-lg font-bold mb-3 ' + d.colorClass + '">' + d.title + '</h4>' + d.content;
    }

    // ── strategy-card 토글 ──
    function toggleStrategy(el) {
        var d = el.querySelector('.strategy-detail');
        var s = el.querySelector('.strategy-summary');
        if (d.classList.contains('hidden')) {
            document.querySelectorAll('.strategy-detail').forEach(function(x){x.classList.add('hidden');});
            document.querySelectorAll('.strategy-summary').forEach(function(x){x.classList.remove('hidden');});
            d.classList.remove('hidden');
            s.classList.add('hidden');
        } else {
            d.classList.add('hidden');
            s.classList.remove('hidden');
        }
    }

    // ── 채팅 ──
    var chatOpen = false;
    function toggleChat() {
        chatOpen = !chatOpen;
        var sb = document.getElementById('chat-sidebar');
        sb.classList.toggle('open', chatOpen);
        sb.classList.toggle('closed', !chatOpen);
    }
    function appendChat(role, html) {
        var d = document.createElement('div');
        d.className = 'chat-msg ' + role;
        if (role === 'ai') { d.innerHTML = '<div class="prose">' + html + '</div>'; }
        else { d.textContent = html; }
        var c = document.getElementById('chatMessages');
        c.appendChild(d);
        c.scrollTop = c.scrollHeight;
    }
    function showTyping() { document.getElementById('typingIndicator').classList.remove('hidden'); }
    function hideTyping() { document.getElementById('typingIndicator').classList.add('hidden'); }
    async function sendChat() {
        if (!geminiKey) { alert('API Key를 먼저 설정해주세요.'); toggleSettings(); return; }
        var input = document.getElementById('chatInput');
        var msg = input.value.trim();
        if (!msg) return;
        input.value = '';
        appendChat('user', msg);
        showTyping();
        try {
            var r = await fetch(
                'https://generativelanguage.googleapis.com/v1beta/models/gemini-3-pro-preview:generateContent?key=' + geminiKey,
                { method:'POST', headers:{'Content-Type':'application/json'},
                  body: JSON.stringify({ contents:[{parts:[{text:"당신은 정보관리기술사 시험 멘토입니다. '데이터 독립성(Data Independence)과 3단계 스키마 구조' 관련 질문에 전문적이고 명쾌하게 답변해주세요. 300자 이내로 핵심만 요약.\n\n질문: " + msg}]}] })
                }
            );
            var d = await r.json();
            hideTyping();
            var answer = d.candidates[0].content.parts[0].text;
            appendChat('ai', marked.parse(answer));
        } catch(e) {
            hideTyping();
            appendChat('ai', '오류가 발생했습니다: ' + e.message);
        }
    }

    // ── 퀴즈 ──
    var quizTypeHistory = [];
    var currentQuizData = null;
    var quizTopics = [
        { category: "3단계 스키마 구조 개관", keywords: "ANSI/SPARC, 1975, 외부-개념-내부, 추상화 수준, 이해관계자" },
        { category: "외부 스키마", keywords: "사용자 뷰, 서브 스키마, View, 보안, 접근 제한, 다수 존재" },
        { category: "개념 스키마", keywords: "통합 논리 구조, DBA, 엔터티, 관계, 무결성 제약조건, 1개" },
        { category: "내부 스키마", keywords: "물리적 저장, 인덱스, B-Tree, Tablespace, 압축, 암호화" },
        { category: "사상(Mapping)과 독립성", keywords: "E-C Mapping, C-I Mapping, 외부/개념 사상, 개념/내부 사상, 변환 규칙" },
        { category: "논리적 데이터 독립성", keywords: "개념 스키마 변경, 외부 스키마 영향 없음, 뷰 재정의, 테이블 분리, 실현 어려움" },
        { category: "물리적 데이터 독립성", keywords: "내부 스키마 변경, 개념 스키마 영향 없음, 인덱스 변경, 파티셔닝, DBMS 자동 지원" },
        { category: "현대적 발전", keywords: "데이터 레이크하우스, dbt, Delta Lake, NoSQL, Schema-on-Read, Codd 12규칙" }
    ];
    async function generateQuiz() {
        if (!geminiKey) { alert('API Key를 먼저 설정해주세요.'); toggleSettings(); return; }
        var btn = document.getElementById('btn-quiz-gen');
        btn.disabled = true; btn.innerHTML = '<span>생성 중...</span>';
        document.getElementById('quiz-placeholder').classList.add('hidden');
        document.getElementById('quiz-container').classList.add('hidden');
        document.getElementById('quiz-loading').classList.remove('hidden');
        var isMC;
        var recent = quizTypeHistory.slice(-2);
        if (recent.length >= 2 && recent[0] === recent[1]) { isMC = !recent[1]; }
        else { isMC = Math.random() > 0.5; }
        quizTypeHistory.push(isMC);
        var selected = quizTopics[Math.floor(Math.random() * quizTopics.length)];
        var quizType = isMC ? '객관식 (4지선다)' : '단답형';
        var format = isMC
            ? '{"question":"문제","options":["A","B","C","D"],"correctIndex":0,"explanation":"해설"}'
            : '{"question":"문제","correctAnswer":"정답","explanation":"해설"}';
        var prompt = "다음 카테고리에 대한 " + quizType + " 퀴즈 1문제를 만드세요.\n"
            + "카테고리: " + selected.category + "\n"
            + "관련 키워드: " + selected.keywords + "\n"
            + "규칙: 반드시 위 카테고리와 키워드에 직접 관련된 문제를 출제하세요.\n"
            + "JSON 형식으로 응답: " + format;
        try {
            var r = await fetch(
                'https://generativelanguage.googleapis.com/v1beta/models/gemini-3-pro-preview:generateContent?key=' + geminiKey,
                { method:'POST', headers:{'Content-Type':'application/json'},
                  body: JSON.stringify({ contents:[{parts:[{text:prompt}]}], generationConfig:{responseMimeType:"application/json"} })
                }
            );
            var d = await r.json();
            var t = d.candidates[0].content.parts[0].text;
            t = t.replace(/```json\s*/gi,"").replace(/```\s*/g,"").trim();
            var depth=0, start=-1, end=-1;
            for (var i=0;i<t.length;i++) {
                if (t[i]==='{') { if(depth===0) start=i; depth++; }
                else if (t[i]==='}') { depth--; if(depth===0 && start!==-1) { end=i; break; } }
            }
            if (start===-1||end===-1) throw new Error("No JSON found");
            t = t.substring(start, end+1);
            t = t.replace(/[\x00-\x1F\x7F]/g, function(c) { return c==='\n'||c==='\r'||c==='\t' ? ' ' : ''; });
            currentQuizData = JSON.parse(t);
            renderQuiz(isMC);
        } catch(e) {
            document.getElementById('quiz-loading').classList.add('hidden');
            document.getElementById('quiz-placeholder').classList.remove('hidden');
            document.getElementById('quiz-placeholder').innerHTML = '<p class="text-red-500">퀴즈 생성 오류: ' + e.message + '</p>';
        }
        btn.disabled = false; btn.innerHTML = '<span>✨ 새로운 문제 생성</span>';
    }
    function renderQuiz(isMC) {
        document.getElementById('quiz-loading').classList.add('hidden');
        document.getElementById('quiz-feedback').classList.add('hidden');
        document.getElementById('quiz-container').classList.remove('hidden');
        document.getElementById('quiz-type-badge').textContent = isMC ? '객관식' : '단답형';
        document.getElementById('quiz-question').textContent = currentQuizData.question;
        var optDiv = document.getElementById('quiz-options');
        var inputDiv = document.getElementById('quiz-input-area');
        if (isMC) {
            optDiv.classList.remove('hidden');
            inputDiv.classList.add('hidden');
            var h = '';
            var letters = ['A','B','C','D'];
            currentQuizData.options.forEach(function(opt, i) {
                h += '<button onclick="checkMultipleChoice(' + i + ', this)" class="w-full text-left p-4 rounded-lg border border-gray-200 hover:bg-indigo-50 hover:border-indigo-300 transition-all mb-2 flex items-center group">'
                    + '<span class="w-8 h-8 rounded-full bg-gray-100 group-hover:bg-indigo-100 flex items-center justify-center text-sm font-bold text-gray-500 group-hover:text-indigo-600 mr-3 flex-shrink-0">' + letters[i] + '</span>'
                    + '<span class="text-sm text-gray-700">' + opt + '</span></button>';
            });
            optDiv.innerHTML = h;
        } else {
            optDiv.classList.add('hidden');
            inputDiv.classList.remove('hidden');
            document.getElementById('quiz-answer-input').value = '';
            document.getElementById('quiz-answer-input').focus();
        }
    }
    function checkMultipleChoice(idx, btnEl) {
        var correct = idx === currentQuizData.correctIndex;
        document.querySelectorAll('#quiz-options button').forEach(function(b, i) {
            b.disabled = true;
            if (i === currentQuizData.correctIndex) { b.classList.add('bg-green-50','border-green-400'); b.querySelector('span:first-child').classList.add('bg-green-100','text-green-700'); }
            else if (i === idx && !correct) { b.classList.add('bg-red-50','border-red-400'); b.querySelector('span:first-child').classList.add('bg-red-100','text-red-700'); }
        });
        showQuizFeedback(correct, currentQuizData.options[currentQuizData.correctIndex], currentQuizData.explanation);
    }
    async function checkShortAnswer() {
        var ans = document.getElementById('quiz-answer-input').value.trim();
        if (!ans) { alert('답을 입력해주세요.'); return; }
        var btn = document.getElementById('btn-short-submit');
        btn.disabled = true; btn.textContent = '채점 중...';
        try {
            var gradingPrompt = "당신은 정보관리기술사 시험 채점관입니다. 아래 문제에 대해 사용자의 답안이 정답으로 인정될 수 있는지 판정하세요.\n\n"
                + "문제: " + currentQuizData.question + "\n"
                + "모범 정답: " + currentQuizData.correctAnswer + "\n"
                + "사용자 답안: " + ans + "\n\n"
                + "판정 기준:\n- 핵심 의미가 동일하면 정답\n- 약어/풀네임 모두 인정\n- 영어/한글 혼용 인정\n- 띄어쓰기/조사 차이는 무시\n- 의미가 명확히 다르면 오답\n\n"
                + "Output JSON: {\"correct\":true/false,\"reason\":\"판정 이유\"}";
            var r = await fetch(
                'https://generativelanguage.googleapis.com/v1beta/models/gemini-3-pro-preview:generateContent?key=' + geminiKey,
                { method:'POST', headers:{'Content-Type':'application/json'},
                  body: JSON.stringify({ contents:[{parts:[{text:gradingPrompt}]}], generationConfig:{responseMimeType:"application/json"} })
                }
            );
            var d = await r.json();
            var gt = d.candidates[0].content.parts[0].text;
            gt = gt.replace(/```json\s*/gi,"").replace(/```\s*/g,"").trim();
            var gd=0,gs=-1,ge=-1;
            for(var i=0;i<gt.length;i++){if(gt[i]==='{'){if(gd===0)gs=i;gd++;}else if(gt[i]==='}'){gd--;if(gd===0&&gs!==-1){ge=i;break;}}}
            if(gs===-1||ge===-1) throw new Error("No JSON");
            gt=gt.substring(gs,ge+1);
            gt=gt.replace(/[\x00-\x1F\x7F]/g,function(c){return c==='\n'||c==='\r'||c==='\t'?' ':'';});
            var result = JSON.parse(gt);
            showQuizFeedback(result.correct, currentQuizData.correctAnswer, currentQuizData.explanation + (result.reason ? ' (AI: ' + result.reason + ')' : ''));
        } catch(e) {
            var normalize = function(s){return s.replace(/\s/g,'').toLowerCase();};
            var correct = normalize(currentQuizData.correctAnswer).includes(normalize(ans)) || normalize(ans).includes(normalize(currentQuizData.correctAnswer));
            showQuizFeedback(correct, currentQuizData.correctAnswer, currentQuizData.explanation + ' (로컬 채점)');
        }
        btn.disabled = false; btn.textContent = '제출';
    }
    function showQuizFeedback(correct, answer, explanation) {
        var fb = document.getElementById('quiz-feedback');
        fb.classList.remove('hidden','border-green-500','bg-green-50','border-red-500','bg-red-50');
        if (correct) {
            fb.classList.add('border-green-500','bg-green-50');
            fb.innerHTML = '<p class="font-bold text-green-700 mb-1">✅ 정답입니다!</p><p class="text-sm text-green-600">' + explanation + '</p>';
        } else {
            fb.classList.add('border-red-500','bg-red-50');
            fb.innerHTML = '<p class="font-bold text-red-700 mb-1">❌ 오답입니다.</p><p class="text-sm text-red-700 mb-1">정답: ' + answer + '</p><p class="text-sm text-red-600">' + explanation + '</p>';
        }
    }
    // Enter key for short answer
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && document.getElementById('quiz-answer-input') === document.activeElement) { checkShortAnswer(); }
    });

    // ── Chart.js 초기화 ──
    document.addEventListener('DOMContentLoaded', function() {
        // 개요 레이더 차트
        var ctx1 = document.getElementById('overviewRadar');
        if (ctx1) {
            new Chart(ctx1.getContext('2d'), {
                type: 'radar',
                data: {
                    labels: ['추상화 수준', '사용자 접근성', '성능 관련', '보안 기능', '개수(복수 가능)'],
                    datasets: [
                        { label: '외부 스키마', data: [3, 5, 1, 5, 5], borderColor: '#6366f1', backgroundColor: 'rgba(99,102,241,0.15)', pointBackgroundColor: '#6366f1' },
                        { label: '개념 스키마', data: [4, 3, 2, 3, 1], borderColor: '#22c55e', backgroundColor: 'rgba(34,197,94,0.15)', pointBackgroundColor: '#22c55e' },
                        { label: '내부 스키마', data: [5, 1, 5, 2, 1], borderColor: '#a855f7', backgroundColor: 'rgba(168,85,247,0.15)', pointBackgroundColor: '#a855f7' }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { r: { beginAtZero: true, max: 5, ticks: { stepSize: 1 } } }, plugins: { legend: { position: 'bottom' } } }
            });
        }
        // 독립성 비교 차트
        var ctx2 = document.getElementById('indepChart');
        if (ctx2) {
            new Chart(ctx2.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: ['실현 난이도', 'DBMS 자동 지원', '영향 범위', '변경 빈도'],
                    datasets: [
                        { label: '논리적 독립성', data: [85, 30, 90, 40], backgroundColor: 'rgba(59,130,246,0.7)', borderColor: '#3b82f6', borderWidth: 1 },
                        { label: '물리적 독립성', data: [30, 85, 40, 75], backgroundColor: 'rgba(249,115,22,0.7)', borderColor: '#f97316', borderWidth: 1 }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, max: 100, ticks: { callback: function(v){return v+'%';} } } }, plugins: { legend: { position: 'bottom' } } }
            });
        }
    });
    </script>
</body>
</html>
